/*!
 * ONNX Runtime Web v1.23.0
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
var Vr=Object.defineProperty;var Cu=Object.getOwnPropertyDescriptor;var Eu=Object.getOwnPropertyNames;var _u=Object.prototype.hasOwnProperty;var Hr=(a=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(a,{get:(i,s)=>(typeof require<"u"?require:i)[s]}):a)(function(a){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+a+'" is not supported')});var F=(a,i)=>()=>(a&&(i=a(a=0)),i);var _t=(a,i)=>{for(var s in i)Vr(a,s,{get:i[s],enumerable:!0})},Su=(a,i,s,n)=>{if(i&&typeof i=="object"||typeof i=="function")for(let f of Eu(i))!_u.call(a,f)&&f!==s&&Vr(a,f,{get:()=>i[f],enumerable:!(n=Cu(i,f))||n.enumerable});return a};var Gt=a=>Su(Vr({},"__esModule",{value:!0}),a);var $t,et,tt,Au,ji,Yr=F(()=>{"use strict";$t=new Map,et=[],tt=(a,i,s)=>{if(i&&typeof i.init=="function"&&typeof i.createInferenceSessionHandler=="function"){let n=$t.get(a);if(n===void 0)$t.set(a,{backend:i,priority:s});else{if(n.priority>s)return;if(n.priority===s&&n.backend!==i)throw new Error(`cannot register backend "${a}" using priority ${s}`)}if(s>=0){let f=et.indexOf(a);f!==-1&&et.splice(f,1);for(let d=0;d<et.length;d++)if($t.get(et[d]).priority<=s){et.splice(d,0,a);return}et.push(a)}return}throw new TypeError("not a valid backend")},Au=async a=>{let i=$t.get(a);if(!i)return"backend not found.";if(i.initialized)return i.backend;if(i.aborted)return i.error;{let s=!!i.initPromise;try{return s||(i.initPromise=i.backend.init(a)),await i.initPromise,i.initialized=!0,i.backend}catch(n){return s||(i.error=`${n}`,i.aborted=!0),i.error}finally{delete i.initPromise}}},ji=async a=>{let i=a.executionProviders||[],s=i.map(h=>typeof h=="string"?h:h.name),n=s.length===0?et:s,f,d=[],p=new Set;for(let h of n){let g=await Au(h);typeof g=="string"?d.push({name:h,err:g}):(f||(f=g),f===g&&p.add(h))}if(!f)throw new Error(`no available backend found. ERR: ${d.map(h=>`[${h.name}] ${h.err}`).join(", ")}`);for(let{name:h,err:g}of d)s.includes(h)&&console.warn(`removing requested execution provider "${h}" from session options because it is not available: ${g}`);let c=i.filter(h=>p.has(typeof h=="string"?h:h.name));return[f,new Proxy(a,{get:(h,g)=>g==="executionProviders"?c:Reflect.get(h,g)})]}});var Gi=F(()=>{"use strict";Yr()});var $i,zi=F(()=>{"use strict";$i="1.23.0"});var Vi,se,qr=F(()=>{"use strict";zi();Vi="warning",se={wasm:{},webgl:{},webgpu:{},versions:{common:$i},set logLevel(a){if(a!==void 0){if(typeof a!="string"||["verbose","info","warning","error","fatal"].indexOf(a)===-1)throw new Error(`Unsupported logging level: ${a}`);Vi=a}},get logLevel(){return Vi}};Object.defineProperty(se,"logLevel",{enumerable:!0})});var X,Hi=F(()=>{"use strict";qr();X=se});var Yi,qi,Ji=F(()=>{"use strict";Yi=(a,i)=>{let s=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);s.width=a.dims[3],s.height=a.dims[2];let n=s.getContext("2d");if(n!=null){let f,d;i?.tensorLayout!==void 0&&i.tensorLayout==="NHWC"?(f=a.dims[2],d=a.dims[3]):(f=a.dims[3],d=a.dims[2]);let p=i?.format!==void 0?i.format:"RGB",c=i?.norm,h,g;c===void 0||c.mean===void 0?h=[255,255,255,255]:typeof c.mean=="number"?h=[c.mean,c.mean,c.mean,c.mean]:(h=[c.mean[0],c.mean[1],c.mean[2],0],c.mean[3]!==void 0&&(h[3]=c.mean[3])),c===void 0||c.bias===void 0?g=[0,0,0,0]:typeof c.bias=="number"?g=[c.bias,c.bias,c.bias,c.bias]:(g=[c.bias[0],c.bias[1],c.bias[2],0],c.bias[3]!==void 0&&(g[3]=c.bias[3]));let v=d*f,C=0,T=v,S=v*2,U=-1;p==="RGBA"?(C=0,T=v,S=v*2,U=v*3):p==="RGB"?(C=0,T=v,S=v*2):p==="RBG"&&(C=0,S=v,T=v*2);for(let D=0;D<d;D++)for(let R=0;R<f;R++){let M=(a.data[C++]-g[0])*h[0],L=(a.data[T++]-g[1])*h[1],j=(a.data[S++]-g[2])*h[2],P=U===-1?255:(a.data[U++]-g[3])*h[3];n.fillStyle="rgba("+M+","+L+","+j+","+P+")",n.fillRect(R,D,1,1)}if("toDataURL"in s)return s.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},qi=(a,i)=>{let s=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),n;if(s!=null){let f,d,p;i?.tensorLayout!==void 0&&i.tensorLayout==="NHWC"?(f=a.dims[2],d=a.dims[1],p=a.dims[3]):(f=a.dims[3],d=a.dims[2],p=a.dims[1]);let c=i!==void 0&&i.format!==void 0?i.format:"RGB",h=i?.norm,g,v;h===void 0||h.mean===void 0?g=[255,255,255,255]:typeof h.mean=="number"?g=[h.mean,h.mean,h.mean,h.mean]:(g=[h.mean[0],h.mean[1],h.mean[2],255],h.mean[3]!==void 0&&(g[3]=h.mean[3])),h===void 0||h.bias===void 0?v=[0,0,0,0]:typeof h.bias=="number"?v=[h.bias,h.bias,h.bias,h.bias]:(v=[h.bias[0],h.bias[1],h.bias[2],0],h.bias[3]!==void 0&&(v[3]=h.bias[3]));let C=d*f;if(i!==void 0&&(i.format!==void 0&&p===4&&i.format!=="RGBA"||p===3&&i.format!=="RGB"&&i.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let T=4,S=0,U=1,D=2,R=3,M=0,L=C,j=C*2,P=-1;c==="RGBA"?(M=0,L=C,j=C*2,P=C*3):c==="RGB"?(M=0,L=C,j=C*2):c==="RBG"&&(M=0,j=C,L=C*2),n=s.createImageData(f,d);for(let z=0;z<d*f;S+=T,U+=T,D+=T,R+=T,z++)n.data[S]=(a.data[M++]-v[0])*g[0],n.data[U]=(a.data[L++]-v[1])*g[1],n.data[D]=(a.data[j++]-v[2])*g[2],n.data[R]=P===-1?255:(a.data[P++]-v[3])*g[3]}else throw new Error("Can not access image data");return n}});var Jr,Xi,Zi,Qi,Ki,eo,to=F(()=>{"use strict";zt();Jr=(a,i)=>{if(a===void 0)throw new Error("Image buffer must be defined");if(i.height===void 0||i.width===void 0)throw new Error("Image height and width must be defined");if(i.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:s,width:n}=i,f=i.norm??{mean:255,bias:0},d,p;typeof f.mean=="number"?d=[f.mean,f.mean,f.mean,f.mean]:d=[f.mean[0],f.mean[1],f.mean[2],f.mean[3]??255],typeof f.bias=="number"?p=[f.bias,f.bias,f.bias,f.bias]:p=[f.bias[0],f.bias[1],f.bias[2],f.bias[3]??0];let c=i.format!==void 0?i.format:"RGBA",h=i.tensorFormat!==void 0&&i.tensorFormat!==void 0?i.tensorFormat:"RGB",g=s*n,v=h==="RGBA"?new Float32Array(g*4):new Float32Array(g*3),C=4,T=0,S=1,U=2,D=3,R=0,M=g,L=g*2,j=-1;c==="RGB"&&(C=3,T=0,S=1,U=2,D=-1),h==="RGBA"?j=g*3:h==="RBG"?(R=0,L=g,M=g*2):h==="BGR"&&(L=0,M=g,R=g*2);for(let z=0;z<g;z++,T+=C,U+=C,S+=C,D+=C)v[R++]=(a[T]+p[0])/d[0],v[M++]=(a[S]+p[1])/d[1],v[L++]=(a[U]+p[2])/d[2],j!==-1&&D!==-1&&(v[j++]=(a[D]+p[3])/d[3]);return h==="RGBA"?new le("float32",v,[1,4,s,n]):new le("float32",v,[1,3,s,n])},Xi=async(a,i)=>{let s=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,n=typeof ImageData<"u"&&a instanceof ImageData,f=typeof ImageBitmap<"u"&&a instanceof ImageBitmap,d=typeof a=="string",p,c=i??{},h=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},g=v=>typeof HTMLCanvasElement<"u"&&v instanceof HTMLCanvasElement||v instanceof OffscreenCanvas?v.getContext("2d"):null;if(s){let v=h();v.width=a.width,v.height=a.height;let C=g(v);if(C!=null){let T=a.height,S=a.width;if(i!==void 0&&i.resizedHeight!==void 0&&i.resizedWidth!==void 0&&(T=i.resizedHeight,S=i.resizedWidth),i!==void 0){if(c=i,i.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");c.tensorFormat="RGBA",c.height=T,c.width=S}else c.tensorFormat="RGBA",c.height=T,c.width=S;C.drawImage(a,0,0),p=C.getImageData(0,0,S,T).data}else throw new Error("Can not access image data")}else if(n){let v,C;if(i!==void 0&&i.resizedWidth!==void 0&&i.resizedHeight!==void 0?(v=i.resizedHeight,C=i.resizedWidth):(v=a.height,C=a.width),i!==void 0&&(c=i),c.format="RGBA",c.height=v,c.width=C,i!==void 0){let T=h();T.width=C,T.height=v;let S=g(T);if(S!=null)S.putImageData(a,0,0),p=S.getImageData(0,0,C,v).data;else throw new Error("Can not access image data")}else p=a.data}else if(f){if(i===void 0)throw new Error("Please provide image config with format for Imagebitmap");let v=h();v.width=a.width,v.height=a.height;let C=g(v);if(C!=null){let T=a.height,S=a.width;return C.drawImage(a,0,0,S,T),p=C.getImageData(0,0,S,T).data,c.height=T,c.width=S,Jr(p,c)}else throw new Error("Can not access image data")}else{if(d)return new Promise((v,C)=>{let T=h(),S=g(T);if(!a||!S)return C();let U=new Image;U.crossOrigin="Anonymous",U.src=a,U.onload=()=>{T.width=U.width,T.height=U.height,S.drawImage(U,0,0,T.width,T.height);let D=S.getImageData(0,0,T.width,T.height);c.height=T.height,c.width=T.width,v(Jr(D.data,c))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(p!==void 0)return Jr(p,c);throw new Error("Input data provided is not supported - aborted tensor creation")},Zi=(a,i)=>{let{width:s,height:n,download:f,dispose:d}=i,p=[1,n,s,4];return new le({location:"texture",type:"float32",texture:a,dims:p,download:f,dispose:d})},Qi=(a,i)=>{let{dataType:s,dims:n,download:f,dispose:d}=i;return new le({location:"gpu-buffer",type:s??"float32",gpuBuffer:a,dims:n,download:f,dispose:d})},Ki=(a,i)=>{let{dataType:s,dims:n,download:f,dispose:d}=i;return new le({location:"ml-tensor",type:s??"float32",mlTensor:a,dims:n,download:f,dispose:d})},eo=(a,i,s)=>new le({location:"cpu-pinned",type:a,data:i,dims:s??[i.length]})});var rt,St,ro,no,io=F(()=>{"use strict";rt=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),St=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),ro=!1,no=()=>{if(!ro){ro=!0;let a=typeof BigInt64Array<"u"&&BigInt64Array.from,i=typeof BigUint64Array<"u"&&BigUint64Array.from,s=globalThis.Float16Array,n=typeof s<"u"&&s.from;a&&(rt.set("int64",BigInt64Array),St.set(BigInt64Array,"int64")),i&&(rt.set("uint64",BigUint64Array),St.set(BigUint64Array,"uint64")),n?(rt.set("float16",s),St.set(s,"float16")):rt.set("float16",Uint16Array)}}});var oo,ao,so=F(()=>{"use strict";zt();oo=a=>{let i=1;for(let s=0;s<a.length;s++){let n=a[s];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${s}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${s}] must be a non-negative integer, got: ${n}`);i*=n}return i},ao=(a,i)=>{switch(a.location){case"cpu":return new le(a.type,a.data,i);case"cpu-pinned":return new le({location:"cpu-pinned",data:a.data,type:a.type,dims:i});case"texture":return new le({location:"texture",texture:a.texture,type:a.type,dims:i});case"gpu-buffer":return new le({location:"gpu-buffer",gpuBuffer:a.gpuBuffer,type:a.type,dims:i});case"ml-tensor":return new le({location:"ml-tensor",mlTensor:a.mlTensor,type:a.type,dims:i});default:throw new Error(`tensorReshape: tensor location ${a.location} is not supported`)}}});var le,zt=F(()=>{"use strict";Ji();to();io();so();le=class{constructor(i,s,n){no();let f,d;if(typeof i=="object"&&"location"in i)switch(this.dataLocation=i.location,f=i.type,d=i.dims,i.location){case"cpu-pinned":{let c=rt.get(f);if(!c)throw new TypeError(`unsupported type "${f}" to create tensor from pinned buffer`);if(!(i.data instanceof c))throw new TypeError(`buffer should be of type ${c.name}`);this.cpuData=i.data;break}case"texture":{if(f!=="float32")throw new TypeError(`unsupported type "${f}" to create tensor from texture`);this.gpuTextureData=i.texture,this.downloader=i.download,this.disposer=i.dispose;break}case"gpu-buffer":{if(f!=="float32"&&f!=="float16"&&f!=="int32"&&f!=="int64"&&f!=="uint32"&&f!=="uint8"&&f!=="bool"&&f!=="uint4"&&f!=="int4")throw new TypeError(`unsupported type "${f}" to create tensor from gpu buffer`);this.gpuBufferData=i.gpuBuffer,this.downloader=i.download,this.disposer=i.dispose;break}case"ml-tensor":{if(f!=="float32"&&f!=="float16"&&f!=="int32"&&f!=="int64"&&f!=="uint32"&&f!=="uint64"&&f!=="int8"&&f!=="uint8"&&f!=="bool"&&f!=="uint4"&&f!=="int4")throw new TypeError(`unsupported type "${f}" to create tensor from MLTensor`);this.mlTensorData=i.mlTensor,this.downloader=i.download,this.disposer=i.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let c,h;if(typeof i=="string")if(f=i,h=n,i==="string"){if(!Array.isArray(s))throw new TypeError("A string tensor's data must be a string array.");c=s}else{let g=rt.get(i);if(g===void 0)throw new TypeError(`Unsupported tensor type: ${i}.`);if(Array.isArray(s)){if(i==="float16"&&g===Uint16Array||i==="uint4"||i==="int4")throw new TypeError(`Creating a ${i} tensor from number array is not supported. Please use ${g.name} as data.`);i==="uint64"||i==="int64"?c=g.from(s,BigInt):c=g.from(s)}else if(s instanceof g)c=s;else if(s instanceof Uint8ClampedArray)if(i==="uint8")c=Uint8Array.from(s);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(i==="float16"&&s instanceof Uint16Array&&g!==Uint16Array)c=new globalThis.Float16Array(s.buffer,s.byteOffset,s.length);else throw new TypeError(`A ${f} tensor's data must be type of ${g}`)}else if(h=s,Array.isArray(i)){if(i.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let g=typeof i[0];if(g==="string")f="string",c=i;else if(g==="boolean")f="bool",c=Uint8Array.from(i);else throw new TypeError(`Invalid element type of data array: ${g}.`)}else if(i instanceof Uint8ClampedArray)f="uint8",c=Uint8Array.from(i);else{let g=St.get(i.constructor);if(g===void 0)throw new TypeError(`Unsupported type for tensor data: ${i.constructor}.`);f=g,c=i}if(h===void 0)h=[c.length];else if(!Array.isArray(h))throw new TypeError("A tensor's dims must be a number array");d=h,this.cpuData=c,this.dataLocation="cpu"}let p=oo(d);if(this.cpuData&&p!==this.cpuData.length&&!((f==="uint4"||f==="int4")&&Math.ceil(p/2)===this.cpuData.length))throw new Error(`Tensor's size(${p}) does not match data length(${this.cpuData.length}).`);this.type=f,this.dims=d,this.size=p}static async fromImage(i,s){return Xi(i,s)}static fromTexture(i,s){return Zi(i,s)}static fromGpuBuffer(i,s){return Qi(i,s)}static fromMLTensor(i,s){return Ki(i,s)}static fromPinnedBuffer(i,s,n){return eo(i,s,n)}toDataURL(i){return Yi(this,i)}toImageData(i){return qi(this,i)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(i){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let s=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=s,i&&this.disposer&&(this.disposer(),this.disposer=void 0),s}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(i){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return ao(this,i)}}});var Oe,Xr=F(()=>{"use strict";zt();Oe=le});var uo,fo,nt,it,Ye,qe,Zr=F(()=>{"use strict";qr();uo=(a,i)=>{(typeof se.trace>"u"?!se.wasm.trace:!se.trace)||console.timeStamp(`${a}::ORT::${i}`)},fo=(a,i)=>{let s=new Error().stack?.split(/\r\n|\r|\n/g)||[],n=!1;for(let f=0;f<s.length;f++){if(n&&!s[f].includes("TRACE_FUNC")){let d=`FUNC_${a}::${s[f].trim().split(" ")[1]}`;i&&(d+=`::${i}`),uo("CPU",d);return}s[f].includes("TRACE_FUNC")&&(n=!0)}},nt=a=>{(typeof se.trace>"u"?!se.wasm.trace:!se.trace)||fo("BEGIN",a)},it=a=>{(typeof se.trace>"u"?!se.wasm.trace:!se.trace)||fo("END",a)},Ye=a=>{(typeof se.trace>"u"?!se.wasm.trace:!se.trace)||console.time(`ORT::${a}`)},qe=a=>{(typeof se.trace>"u"?!se.wasm.trace:!se.trace)||console.timeEnd(`ORT::${a}`)}});var Vt,lo=F(()=>{"use strict";Yr();Xr();Zr();Vt=class a{constructor(i){this.handler=i}async run(i,s,n){nt(),Ye("InferenceSession.run");let f={},d={};if(typeof i!="object"||i===null||i instanceof Oe||Array.isArray(i))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let p=!0;if(typeof s=="object"){if(s===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(s instanceof Oe)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(s)){if(s.length===0)throw new TypeError("'fetches' cannot be an empty array.");p=!1;for(let g of s){if(typeof g!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(g)===-1)throw new RangeError(`'fetches' contains invalid output name: ${g}.`);f[g]=null}if(typeof n=="object"&&n!==null)d=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let g=!1,v=Object.getOwnPropertyNames(s);for(let C of this.outputNames)if(v.indexOf(C)!==-1){let T=s[C];(T===null||T instanceof Oe)&&(g=!0,p=!1,f[C]=T)}if(g){if(typeof n=="object"&&n!==null)d=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else d=s}}else if(typeof s<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let g of this.inputNames)if(typeof i[g]>"u")throw new Error(`input '${g}' is missing in 'feeds'.`);if(p)for(let g of this.outputNames)f[g]=null;let c=await this.handler.run(i,f,d),h={};for(let g in c)if(Object.hasOwnProperty.call(c,g)){let v=c[g];v instanceof Oe?h[g]=v:h[g]=new Oe(v.type,v.data,v.dims)}return qe("InferenceSession.run"),it(),h}async release(){return this.handler.dispose()}static async create(i,s,n,f){nt(),Ye("InferenceSession.create");let d,p={};if(typeof i=="string"){if(d=i,typeof s=="object"&&s!==null)p=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(i instanceof Uint8Array){if(d=i,typeof s=="object"&&s!==null)p=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(i instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&i instanceof SharedArrayBuffer){let v=i,C=0,T=i.byteLength;if(typeof s=="object"&&s!==null)p=s;else if(typeof s=="number"){if(C=s,!Number.isSafeInteger(C))throw new RangeError("'byteOffset' must be an integer.");if(C<0||C>=v.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${v.byteLength}).`);if(T=i.byteLength-C,typeof n=="number"){if(T=n,!Number.isSafeInteger(T))throw new RangeError("'byteLength' must be an integer.");if(T<=0||C+T>v.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${v.byteLength-C}].`);if(typeof f=="object"&&f!==null)p=f;else if(typeof f<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof s<"u")throw new TypeError("'options' must be an object.");d=new Uint8Array(v,C,T)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[c,h]=await ji(p),g=await c.createInferenceSessionHandler(d,h);return qe("InferenceSession.create"),it(),new a(g)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}});var xu,co=F(()=>{"use strict";lo();xu=Vt});var po=F(()=>{"use strict"});var mo=F(()=>{"use strict"});var yo=F(()=>{"use strict"});var ho=F(()=>{"use strict"});var Qr={};_t(Qr,{InferenceSession:()=>xu,TRACE:()=>uo,TRACE_EVENT_BEGIN:()=>Ye,TRACE_EVENT_END:()=>qe,TRACE_FUNC_BEGIN:()=>nt,TRACE_FUNC_END:()=>it,Tensor:()=>Oe,env:()=>X,registerBackend:()=>tt});var Je=F(()=>{"use strict";Gi();Hi();co();Xr();po();mo();Zr();yo();ho()});var Ht=F(()=>{"use strict"});var vo={};_t(vo,{default:()=>Iu});var go,wo,Iu,To=F(()=>{"use strict";Kr();Xe();Yt();go="ort-wasm-proxy-worker",wo=globalThis.self?.name===go;wo&&(self.onmessage=a=>{let{type:i,in:s}=a.data;try{switch(i){case"init-wasm":qt(s.wasm).then(()=>{Jt(s).then(()=>{postMessage({type:i})},n=>{postMessage({type:i,err:n})})},n=>{postMessage({type:i,err:n})});break;case"init-ep":{let{epName:n,env:f}=s;Xt(f,n).then(()=>{postMessage({type:i})},d=>{postMessage({type:i,err:d})});break}case"copy-from":{let{buffer:n}=s,f=At(n);postMessage({type:i,out:f});break}case"create":{let{model:n,options:f}=s;Zt(n,f).then(d=>{postMessage({type:i,out:d})},d=>{postMessage({type:i,err:d})});break}case"release":Qt(s),postMessage({type:i});break;case"run":{let{sessionId:n,inputIndices:f,inputs:d,outputIndices:p,options:c}=s;Kt(n,f,d,p,new Array(p.length).fill(null),c).then(h=>{h.some(g=>g[3]!=="cpu")?postMessage({type:i,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:i,out:h},tr([...d,...h]))},h=>{postMessage({type:i,err:h})});break}case"end-profiling":er(s),postMessage({type:i});break;default:}}catch(n){postMessage({type:i,err:n})}});Iu=wo?null:a=>new Worker(a??be,{type:"module",name:go})});var Eo={};_t(Eo,{default:()=>Ou});var Co,Ou,Lu,_o=F(()=>{"use strict";Co=async function(a={}){var i,s,n=a,f=new Promise((e,t)=>{i=e,s=t}),d=typeof window=="object",p=typeof WorkerGlobalScope<"u",c=p&&self.name?.startsWith("em-pthread");n.mountExternalData=(e,t)=>{e.startsWith("./")&&(e=e.substring(2)),(n.fc||(n.fc=new Map)).set(e,t)},n.unmountExternalData=()=>{delete n.fc};var h=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,ld:!0}).buffer.constructor;let g=()=>{let e=(t,r,o)=>(...u)=>{let l=Me,m=r?.();u=t(...u);let y=r?.();return m!==y&&(t=y,o(m),r=o=null),Me!=l?new Promise((w,E)=>{Ir={resolve:w,reject:E}}):u};(()=>{for(let t of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])n[t]=e(n[t],()=>n[t],r=>n[t]=r)})(),typeof jsepRunAsync<"u"&&(n._OrtRun=jsepRunAsync(n._OrtRun),n._OrtRunWithBinding=jsepRunAsync(n._OrtRunWithBinding)),g=void 0};n.asyncInit=()=>{g?.()};var v,C,T=(e,t)=>{throw t},S=import.meta.url,U="";if(d||p){try{U=new URL(".",S).href}catch{}p&&(C=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),v=async e=>{if(Z(e))return new Promise((r,o)=>{var u=new XMLHttpRequest;u.open("GET",e,!0),u.responseType="arraybuffer",u.onload=()=>{u.status==200||u.status==0&&u.response?r(u.response):o(u.status)},u.onerror=o,u.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)}}var D,R,M,L,j,P,z,ne,fe,te,oe,ie,Q,ge,wt,W=console.log.bind(console),we=console.error.bind(console),lt=W,N=we,ue=!1,Z=e=>e.startsWith("file://");function re(){return R.buffer!=j.buffer&&V(),j}function ae(){return R.buffer!=j.buffer&&V(),P}function Le(){return R.buffer!=j.buffer&&V(),z}function $e(){return R.buffer!=j.buffer&&V(),ne}function I(){return R.buffer!=j.buffer&&V(),fe}function _(){return R.buffer!=j.buffer&&V(),te}function ve(){return R.buffer!=j.buffer&&V(),oe}function de(){return R.buffer!=j.buffer&&V(),ge}if(c){let e=function(t){try{var r=t.data,o=r.dc;if(o==="load"){let u=[];self.onmessage=l=>u.push(l),self.startWorker=()=>{postMessage({dc:"loaded"});for(let l of u)e(l);self.onmessage=e};for(let l of r.Uc)n[l]&&!n[l].proxy||(n[l]=(...m)=>{postMessage({dc:"callHandler",Tc:l,args:m})},l=="print"&&(lt=n[l]),l=="printErr"&&(N=n[l]));R=r.bd,V(),wt(r.cd)}else if(o==="run"){la(r.ac),jr(r.ac,0,0,1,0,0),Cn(),Ar(r.ac),De||(hi(),De=!0);try{ca(r.Zc,r.jc)}catch(u){if(u!="unwind")throw u}}else r.target!=="setimmediate"&&(o==="checkMailbox"?De&&Bt():o&&(N(`worker: received unknown command ${o}`),N(r)))}catch(u){throw Li(),u}};var ef=e,De=!1;self.onunhandledrejection=t=>{throw t.reason||t},self.onmessage=e}function V(){var e=R.buffer;n.HEAP8=j=new Int8Array(e),z=new Int16Array(e),n.HEAPU8=P=new Uint8Array(e),ne=new Uint16Array(e),n.HEAP32=fe=new Int32Array(e),n.HEAPU32=te=new Uint32Array(e),oe=new Float32Array(e),ge=new Float64Array(e),ie=new BigInt64Array(e),Q=new BigUint64Array(e)}function q(){c?startWorker(n):b.nb()}var Te,Ae=0,Pe=null;function yr(){if(--Ae==0&&Pe){var e=Pe;Pe=null,e()}}function Re(e){throw N(e="Aborted("+e+")"),ue=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),s(e),e}function hn(){return{a:{R:vu,b:pa,ba:An,I:On,ra:Ln,jb:Bn,lb:Mn,sa:Un,pa:Dn,ia:Pn,oa:Rn,P:Wn,kb:kn,hb:Nn,qa:Fn,ib:jn,xa:ma,Z:ha,cb:ba,ab:wa,Y:Ta,w:Ca,t:Ea,bb:_a,L:Ba,db:Ma,la:Ua,fb:Da,ca:Pa,_a:Ra,$:Wa,ka:Ar,ua:ka,s:Na,Na:Fa,A:$a,o:za,m:Ha,c:Er,Ma:Ya,n:qa,i:Za,v:Qa,p:Ka,f:es,u:ts,k:rs,e:ns,j:is,h:os,g:as,d:ss,fa:us,ga:fs,ha:ls,da:ei,ea:ti,$a:ri,za:ds,wa:ys,E:hs,La:bs,M:gs,va:ps,C:ws,ta:vs,gb:Ts,r:cs,Ia:Cs,F:Es,Q:_s,eb:Ss,Ba:As,Aa:xs,Ha:Ds,q:Ps,U:Rs,T:Ws,Ka:ks,D:Ns,l:Fs,Ga:js,Fa:Gs,Ja:$s,Ea:zs,Da:Vs,Ca:Hs,ma:ui,na:fi,aa:wr,J:li,O:ci,ja:di,N:pi,a:R,ya:gr,Xa:qs,K:Js,x:Xs,S:Zs,Ya:Qs,y:Ks,Ta:eu,Va:tu,V:ru,z:nu,_:iu,W:ou,G:au,Ra:su,mb:uu,B:fu,Ua:lu,Wa:cu,Oa:du,Pa:pu,Qa:mu,H:yu,X:hu,Sa:bu,Za:gu}}}class hr{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var bn=e=>{e.terminate(),e.onmessage=()=>{}},br=[],gn=e=>{ze.length==0&&(_n(),En(ze[0]));var t=ze.pop();if(!t)return 6;vt.push(t),Qe[e.ac]=t,t.ac=e.ac;var r={dc:"run",Zc:e.Yc,jc:e.jc,ac:e.ac};return t.postMessage(r,e.Oc),0},K=0,J=(e,t,...r)=>{for(var o=2*r.length,u=_e(),l=jt(8*o),m=l>>>3,y=0;y<r.length;y++){var w=r[y];typeof w=="bigint"?(ie[m+2*y]=1n,ie[m+2*y+1]=w):(ie[m+2*y]=0n,de()[m+2*y+1>>>0]=w)}return e=Bi(e,0,o,l,t),Ee(u),e};function gr(e){if(c)return J(0,1,e);if(L=e,!(0<K)){for(var t of vt)bn(t);for(t of ze)bn(t);ze=[],vt=[],Qe={},ue=!0}T(0,new hr(e))}function wn(e){if(c)return J(1,0,e);wr(e)}var wr=e=>{if(L=e,c)throw wn(e),"unwind";gr(e)},ze=[],vt=[],vn=[],Qe={},Tn=e=>{var t=e.ac;delete Qe[t],ze.push(e),vt.splice(vt.indexOf(e),1),e.ac=0,Mi(t)};function Cn(){vn.forEach(e=>e())}var En=e=>new Promise(t=>{e.onmessage=u=>{var l=(u=u.data).dc;if(u.hc&&u.hc!=Rr()){var m=Qe[u.hc];m?m.postMessage(u,u.Oc):N(`Internal error! Worker sent a message "${l}" to target pthread ${u.hc}, but that thread no longer exists!`)}else l==="checkMailbox"?Bt():l==="spawnThread"?gn(u):l==="cleanupThread"?Tn(Qe[u.$c]):l==="loaded"?(e.loaded=!0,t(e)):u.target==="setimmediate"?e.postMessage(u):l==="callHandler"?n[u.Tc](...u.args):l&&N(`worker sent an unknown command ${l}`)},e.onerror=u=>{throw N(`worker sent an error! ${u.filename}:${u.lineno}: ${u.message}`),u};var r,o=[];for(r of[])n.propertyIsEnumerable(r)&&o.push(r);e.postMessage({dc:"load",Uc:o,bd:R,cd:M})});function _n(){var e=new Worker((()=>{let t=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new t("ort.webgpu.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});ze.push(e)}var la=e=>{V();var t=_()[e+52>>>2>>>0];e=_()[e+56>>>2>>>0],Pi(t,t-e),Ee(t)},ca=(e,t)=>{K=0,e=Ri(e,t),0<K?L=e:Gr(e)};class da{constructor(t){this.ic=t-24}}var he=e=>-9007199254740992>e||9007199254740992<e?NaN:Number(e);function pa(e,t,r){var o=new da(e>>>=0);throw t>>>=0,r>>>=0,_()[o.ic+16>>>2>>>0]=0,_()[o.ic+4>>>2>>>0]=t,_()[o.ic+8>>>2>>>0]=r,e}function Sn(e,t,r,o){return c?J(2,1,e,t,r,o):An(e,t,r,o)}function An(e,t,r,o){if(e>>>=0,r>>>=0,o>>>=0,h===void 0)return 6;var u=[];return c&&u.length===0?Sn(e,t>>>=0,r,o):(e={Yc:r,ac:e,jc:o,Oc:u},c?(e.dc="spawnThread",postMessage(e,u),0):gn(e))}var xn=typeof TextDecoder<"u"?new TextDecoder:void 0,In=(e,t=0,r=NaN)=>{var o=(t>>>=0)+r;for(r=t;e[r]&&!(r>=o);)++r;if(16<r-t&&e.buffer&&xn)return xn.decode(e.buffer instanceof ArrayBuffer?e.subarray(t,r):e.slice(t,r));for(o="";t<r;){var u=e[t++];if(128&u){var l=63&e[t++];if((224&u)==192)o+=String.fromCharCode((31&u)<<6|l);else{var m=63&e[t++];65536>(u=(240&u)==224?(15&u)<<12|l<<6|m:(7&u)<<18|l<<12|m<<6|63&e[t++])?o+=String.fromCharCode(u):(u-=65536,o+=String.fromCharCode(55296|u>>10,56320|1023&u))}}else o+=String.fromCharCode(u)}return o},ct=(e,t)=>(e>>>=0)?In(ae(),e,t):"";function On(e,t,r){return c?J(3,1,e,t,r):0}function Ln(e,t){if(c)return J(4,1,e,t)}function Bn(e,t){if(c)return J(5,1,e,t)}function Mn(e,t,r){if(c)return J(6,1,e,t,r)}function Un(e,t,r){return c?J(7,1,e,t,r):0}function Dn(e,t){if(c)return J(8,1,e,t)}function Pn(e,t,r){if(c)return J(9,1,e,t,r)}function Rn(e,t,r,o){if(c)return J(10,1,e,t,r,o)}function Wn(e,t,r,o){if(c)return J(11,1,e,t,r,o)}function kn(e,t,r,o){if(c)return J(12,1,e,t,r,o)}function Nn(e){if(c)return J(13,1,e)}function Fn(e,t){if(c)return J(14,1,e,t)}function jn(e,t,r){if(c)return J(15,1,e,t,r)}var Gn,ma=()=>Re(""),Be=e=>{for(var t="";ae()[e>>>0];)t+=Gn[ae()[e++>>>0]];return t},vr={},Tr={},ya={},dt=n.BindingError=class extends Error{constructor(e){super(e),this.name="BindingError"}};function We(e,t,r={}){return function(o,u,l={}){var m=u.name;if(!o)throw new dt(`type "${m}" must have a positive integer typeid pointer`);if(Tr.hasOwnProperty(o)){if(l.Vc)return;throw new dt(`Cannot register type '${m}' twice`)}Tr[o]=u,delete ya[o],vr.hasOwnProperty(o)&&(u=vr[o],delete vr[o],u.forEach(y=>y()))}(e,t,r)}var $n=(e,t,r)=>{switch(t){case 1:return r?o=>re()[o>>>0]:o=>ae()[o>>>0];case 2:return r?o=>Le()[o>>>1>>>0]:o=>$e()[o>>>1>>>0];case 4:return r?o=>I()[o>>>2>>>0]:o=>_()[o>>>2>>>0];case 8:return r?o=>ie[o>>>3]:o=>Q[o>>>3];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}};function ha(e,t,r){r>>>=0,We(e>>>=0,{name:t=Be(t>>>0),fromWireType:o=>o,toWireType:function(o,u){if(typeof u!="bigint"&&typeof u!="number")throw u=u===null?"null":(o=typeof u)=="object"||o==="array"||o==="function"?u.toString():""+u,new TypeError(`Cannot convert "${u}" to ${this.name}`);return typeof u=="number"&&(u=BigInt(u)),u},cc:Ve,readValueFromPointer:$n(t,r,t.indexOf("u")==-1),ec:null})}var Ve=8;function ba(e,t,r,o){We(e>>>=0,{name:t=Be(t>>>0),fromWireType:function(u){return!!u},toWireType:function(u,l){return l?r:o},cc:Ve,readValueFromPointer:function(u){return this.fromWireType(ae()[u>>>0])},ec:null})}var Cr=[],ke=[];function Er(e){9<(e>>>=0)&&--ke[e+1]==0&&(ke[e]=void 0,Cr.push(e))}var pe=e=>{if(!e)throw new dt(`Cannot use deleted val. handle = ${e}`);return ke[e]},Ce=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let t=Cr.pop()||ke.length;return ke[t]=e,ke[t+1]=1,t}};function _r(e){return this.fromWireType(_()[e>>>2>>>0])}var ga={name:"emscripten::val",fromWireType:e=>{var t=pe(e);return Er(e),t},toWireType:(e,t)=>Ce(t),cc:Ve,readValueFromPointer:_r,ec:null};function wa(e){return We(e>>>0,ga)}var va=(e,t)=>{switch(t){case 4:return function(r){return this.fromWireType(ve()[r>>>2>>>0])};case 8:return function(r){return this.fromWireType(de()[r>>>3>>>0])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}};function Ta(e,t,r){r>>>=0,We(e>>>=0,{name:t=Be(t>>>0),fromWireType:o=>o,toWireType:(o,u)=>u,cc:Ve,readValueFromPointer:va(t,r),ec:null})}function Ca(e,t,r,o,u){if(e>>>=0,r>>>=0,t=Be(t>>>0),u===-1&&(u=4294967295),u=y=>y,o===0){var l=32-8*r;u=y=>y<<l>>>l}var m=t.includes("unsigned")?function(y,w){return w>>>0}:function(y,w){return w};We(e,{name:t,fromWireType:u,toWireType:m,cc:Ve,readValueFromPointer:$n(t,r,o!==0),ec:null})}function Ea(e,t,r){function o(l){var m=_()[l>>>2>>>0];return l=_()[l+4>>>2>>>0],new u(re().buffer,l,m)}var u=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];We(e>>>=0,{name:r=Be(r>>>0),fromWireType:o,cc:Ve,readValueFromPointer:o},{Vc:!0})}var Ne=(e,t,r)=>{var o=ae();if(t>>>=0,0<r){var u=t;r=t+r-1;for(var l=0;l<e.length;++l){var m=e.charCodeAt(l);if(55296<=m&&57343>=m&&(m=65536+((1023&m)<<10)|1023&e.charCodeAt(++l)),127>=m){if(t>=r)break;o[t++>>>0]=m}else{if(2047>=m){if(t+1>=r)break;o[t++>>>0]=192|m>>6}else{if(65535>=m){if(t+2>=r)break;o[t++>>>0]=224|m>>12}else{if(t+3>=r)break;o[t++>>>0]=240|m>>18,o[t++>>>0]=128|m>>12&63}o[t++>>>0]=128|m>>6&63}o[t++>>>0]=128|63&m}}o[t>>>0]=0,e=t-u}else e=0;return e},Fe=e=>{for(var t=0,r=0;r<e.length;++r){var o=e.charCodeAt(r);127>=o?t++:2047>=o?t+=2:55296<=o&&57343>=o?(t+=4,++r):t+=3}return t};function _a(e,t){We(e>>>=0,{name:t=Be(t>>>0),fromWireType:function(r){for(var o,u=_()[r>>>2>>>0],l=r+4,m=l,y=0;y<=u;++y){var w=l+y;y!=u&&ae()[w>>>0]!=0||(m=ct(m,w-m),o===void 0?o=m:(o+="\0",o+=m),m=w+1)}return xe(r),o},toWireType:function(r,o){o instanceof ArrayBuffer&&(o=new Uint8Array(o));var u=typeof o=="string";if(!(u||ArrayBuffer.isView(o)&&o.BYTES_PER_ELEMENT==1))throw new dt("Cannot pass non-string to std::string");var l=u?Fe(o):o.length,m=yt(4+l+1),y=m+4;return _()[m>>>2>>>0]=l,u?Ne(o,y,l+1):ae().set(o,y>>>0),r!==null&&r.push(xe,m),m},cc:Ve,readValueFromPointer:_r,ec(r){xe(r)}})}var zn=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Sa=(e,t)=>{for(var r=e>>1,o=r+t/2;!(r>=o)&&$e()[r>>>0];)++r;if(32<(r<<=1)-e&&zn)return zn.decode(ae().slice(e,r));for(r="",o=0;!(o>=t/2);++o){var u=Le()[e+2*o>>>1>>>0];if(u==0)break;r+=String.fromCharCode(u)}return r},Aa=(e,t,r)=>{if(r??=2147483647,2>r)return 0;var o=t;r=(r-=2)<2*e.length?r/2:e.length;for(var u=0;u<r;++u){var l=e.charCodeAt(u);Le()[t>>>1>>>0]=l,t+=2}return Le()[t>>>1>>>0]=0,t-o},xa=e=>2*e.length,Ia=(e,t)=>{for(var r=0,o="";!(r>=t/4);){var u=I()[e+4*r>>>2>>>0];if(u==0)break;++r,65536<=u?(u-=65536,o+=String.fromCharCode(55296|u>>10,56320|1023&u)):o+=String.fromCharCode(u)}return o},Oa=(e,t,r)=>{if(t>>>=0,r??=2147483647,4>r)return 0;var o=t;r=o+r-4;for(var u=0;u<e.length;++u){var l=e.charCodeAt(u);if(55296<=l&&57343>=l&&(l=65536+((1023&l)<<10)|1023&e.charCodeAt(++u)),I()[t>>>2>>>0]=l,(t+=4)+4>r)break}return I()[t>>>2>>>0]=0,t-o},La=e=>{for(var t=0,r=0;r<e.length;++r){var o=e.charCodeAt(r);55296<=o&&57343>=o&&++r,t+=4}return t};function Ba(e,t,r){if(e>>>=0,t>>>=0,r=Be(r>>>=0),t===2)var o=Sa,u=Aa,l=xa,m=y=>$e()[y>>>1>>>0];else t===4&&(o=Ia,u=Oa,l=La,m=y=>_()[y>>>2>>>0]);We(e,{name:r,fromWireType:y=>{for(var w,E=_()[y>>>2>>>0],A=y+4,O=0;O<=E;++O){var k=y+4+O*t;O!=E&&m(k)!=0||(A=o(A,k-A),w===void 0?w=A:(w+="\0",w+=A),A=k+t)}return xe(y),w},toWireType:(y,w)=>{if(typeof w!="string")throw new dt(`Cannot pass non-string to C++ string type ${r}`);var E=l(w),A=yt(4+E+t);return _()[A>>>2>>>0]=E/t,u(w,A+4,E+t),y!==null&&y.push(xe,A),A},cc:Ve,readValueFromPointer:_r,ec(y){xe(y)}})}function Ma(e,t){We(e>>>=0,{Wc:!0,name:t=Be(t>>>0),cc:0,fromWireType:()=>{},toWireType:()=>{}})}function Ua(e){jr(e>>>0,!p,1,!d,131072,!1),Cn()}var Sr=e=>{if(!ue)try{if(e(),!(0<K))try{c?Gr(L):wr(L)}catch(t){t instanceof hr||t=="unwind"||T(0,t)}}catch(t){t instanceof hr||t=="unwind"||T(0,t)}};function Ar(e){e>>>=0,typeof Atomics.ad=="function"&&(Atomics.ad(I(),e>>>2,e).value.then(Bt),e+=128,Atomics.store(I(),e>>>2,1))}var Bt=()=>{var e=Rr();e&&(Ar(e),Sr(Di))};function Da(e,t){(e>>>=0)==t>>>0?setTimeout(Bt):c?postMessage({hc:e,dc:"checkMailbox"}):(e=Qe[e])&&e.postMessage({dc:"checkMailbox"})}var xr=[];function Pa(e,t,r,o,u){for(t>>>=0,o/=2,xr.length=o,r=u>>>0>>>3,u=0;u<o;u++)xr[u]=ie[r+2*u]?ie[r+2*u+1]:de()[r+2*u+1>>>0];return(t?Dr[t]:wu[e])(...xr)}var Ra=()=>{K=0};function Wa(e){e>>>=0,c?postMessage({dc:"cleanupThread",$c:e}):Tn(Qe[e])}function ka(e){}var Mt=(e,t)=>{var r=Tr[e];if(r===void 0)throw e=yi(e),r=Be(e),xe(e),new dt(`${t} has unknown type ${r}`);return r},Vn=(e,t,r)=>{var o=[];return e=e.toWireType(o,r),o.length&&(_()[t>>>2>>>0]=Ce(o)),e};function Na(e,t,r){return t>>>=0,r>>>=0,e=pe(e>>>0),t=Mt(t,"emval::as"),Vn(t,r,e)}function Fa(e,t){return t>>>=0,e=pe(e>>>0),(t=Mt(t,"emval::as")).toWireType(null,e)}var Ut=e=>{try{e()}catch(t){Re(t)}},He=0,Me=null,Hn=0,Dt=[],Yn={},qn={},ja=0,Ir=null,Ga=[];function Jn(e){return function(t){if(!ue){if(He===0){var r=!1,o=!1;t((u=0)=>{if(!ue&&(Hn=u,r=!0,o)){He=2,Ut(()=>Ni(Me)),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.resume(),u=!1;try{var l=function(){var w=I()[Me+8>>>2>>>0];return w=b[qn[w]],--K,w()}()}catch(w){l=w,u=!0}var m=!1;if(!Me){var y=Ir;y&&(Ir=null,(u?y.reject:y.resolve)(l),m=!0)}if(u&&!m)throw l}}),o=!0,r||(He=1,Me=function(){var u=yt(65548),l=u+12;_()[u>>>2>>>0]=l,_()[u+4>>>2>>>0]=l+65536,l=Dt[0];var m=Yn[l];return m===void 0&&(m=ja++,Yn[l]=m,qn[m]=l),l=m,I()[u+8>>>2>>>0]=l,u}(),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.pause(),Ut(()=>Wi(Me)))}else He===2?(He=0,Ut(Fi),xe(Me),Me=null,Ga.forEach(Sr)):Re(`invalid state: ${He}`);return Hn}}(t=>{e().then(t)})}function $a(e){return e>>>=0,Jn(async()=>{var t=await pe(e);return Ce(t)})}var Pt=[];function za(e,t,r,o){return r>>>=0,o>>>=0,(e=Pt[e>>>0])(null,t=pe(t>>>0),r,o)}var Va={},Rt=e=>{var t=Va[e];return t===void 0?Be(e):t};function Ha(e,t,r,o,u){return r>>>=0,o>>>=0,u>>>=0,(e=Pt[e>>>0])(t=pe(t>>>0),t[r=Rt(r)],o,u)}function Ya(e,t){return t>>>=0,(e=pe(e>>>0))==pe(t)}var Xn=()=>typeof globalThis=="object"?globalThis:Function("return this")();function qa(e){return(e>>>=0)==0?Ce(Xn()):(e=Rt(e),Ce(Xn()[e]))}var Ja=e=>{var t=Pt.length;return Pt.push(e),t},Xa=(e,t)=>{for(var r=Array(e),o=0;o<e;++o)r[o]=Mt(_()[t+4*o>>>2>>>0],`parameter ${o}`);return r};function Za(e,t,r){var o=(t=Xa(e,t>>>0)).shift();e--;var u=`return function (obj, func, destructorsRef, args) {
`,l=0,m=[];r===0&&m.push("obj");for(var y=["retType"],w=[o],E=0;E<e;++E)m.push(`arg${E}`),y.push(`argType${E}`),w.push(t[E]),u+=`  var arg${E} = argType${E}.readValueFromPointer(args${l?"+"+l:""});
`,l+=t[E].cc;return u+=`  var rv = ${r===1?"new func":"func.call"}(${m.join(", ")});
`,o.Wc||(y.push("emval_returnValue"),w.push(Vn),u+=`  return emval_returnValue(retType, destructorsRef, rv);
`),e=new Function(...y,u+`};
`)(...w),r=`methodCaller<(${t.map(A=>A.name).join(", ")}) => ${o.name}>`,Ja(Object.defineProperty(e,"name",{value:r}))}function Qa(e){return e=Rt(e>>>0),Ce(n[e])}function Ka(e,t){return t>>>=0,e=pe(e>>>0),t=pe(t),Ce(e[t])}function es(e){9<(e>>>=0)&&(ke[e+1]+=1)}function ts(){return Ce([])}function rs(e){e=pe(e>>>0);for(var t=Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return Ce(t)}function ns(e){return Ce(Rt(e>>>0))}function is(){return Ce({})}function os(e){for(var t=pe(e>>>=0);t.length;){var r=t.pop();t.pop()(r)}Er(e)}function as(e,t,r){t>>>=0,r>>>=0,e=pe(e>>>0),t=pe(t),r=pe(r),e[t]=r}function ss(e,t){return t>>>=0,e=(e=Mt(e>>>0,"_emval_take_value")).readValueFromPointer(t),Ce(e)}function us(e,t){e=he(e),t>>>=0,e=new Date(1e3*e),I()[t>>>2>>>0]=e.getUTCSeconds(),I()[t+4>>>2>>>0]=e.getUTCMinutes(),I()[t+8>>>2>>>0]=e.getUTCHours(),I()[t+12>>>2>>>0]=e.getUTCDate(),I()[t+16>>>2>>>0]=e.getUTCMonth(),I()[t+20>>>2>>>0]=e.getUTCFullYear()-1900,I()[t+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,I()[t+28>>>2>>>0]=e}var Zn=e=>e%4==0&&(e%100!=0||e%400==0),Qn=[0,31,60,91,121,152,182,213,244,274,305,335],Kn=[0,31,59,90,120,151,181,212,243,273,304,334];function fs(e,t){e=he(e),t>>>=0,e=new Date(1e3*e),I()[t>>>2>>>0]=e.getSeconds(),I()[t+4>>>2>>>0]=e.getMinutes(),I()[t+8>>>2>>>0]=e.getHours(),I()[t+12>>>2>>>0]=e.getDate(),I()[t+16>>>2>>>0]=e.getMonth(),I()[t+20>>>2>>>0]=e.getFullYear()-1900,I()[t+24>>>2>>>0]=e.getDay();var r=(Zn(e.getFullYear())?Qn:Kn)[e.getMonth()]+e.getDate()-1|0;I()[t+28>>>2>>>0]=r,I()[t+36>>>2>>>0]=-60*e.getTimezoneOffset(),r=new Date(e.getFullYear(),6,1).getTimezoneOffset();var o=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(r!=o&&e.getTimezoneOffset()==Math.min(o,r)),I()[t+32>>>2>>>0]=e}function ls(e){e>>>=0;var t=new Date(I()[e+20>>>2>>>0]+1900,I()[e+16>>>2>>>0],I()[e+12>>>2>>>0],I()[e+8>>>2>>>0],I()[e+4>>>2>>>0],I()[e>>>2>>>0],0),r=I()[e+32>>>2>>>0],o=t.getTimezoneOffset(),u=new Date(t.getFullYear(),6,1).getTimezoneOffset(),l=new Date(t.getFullYear(),0,1).getTimezoneOffset(),m=Math.min(l,u);return 0>r?I()[e+32>>>2>>>0]=+(u!=l&&m==o):0<r!=(m==o)&&(u=Math.max(l,u),t.setTime(t.getTime()+6e4*((0<r?m:u)-o))),I()[e+24>>>2>>>0]=t.getDay(),r=(Zn(t.getFullYear())?Qn:Kn)[t.getMonth()]+t.getDate()-1|0,I()[e+28>>>2>>>0]=r,I()[e>>>2>>>0]=t.getSeconds(),I()[e+4>>>2>>>0]=t.getMinutes(),I()[e+8>>>2>>>0]=t.getHours(),I()[e+12>>>2>>>0]=t.getDate(),I()[e+16>>>2>>>0]=t.getMonth(),I()[e+20>>>2>>>0]=t.getYear(),e=t.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function ei(e,t,r,o,u,l,m){return c?J(16,1,e,t,r,o,u,l,m):-52}function ti(e,t,r,o,u,l){if(c)return J(17,1,e,t,r,o,u,l)}var Tt={},cs=()=>performance.timeOrigin+performance.now();function ri(e,t){if(c)return J(18,1,e,t);if(Tt[e]&&(clearTimeout(Tt[e].id),delete Tt[e]),!t)return 0;var r=setTimeout(()=>{delete Tt[e],Sr(()=>Ui(e,performance.timeOrigin+performance.now()))},t);return Tt[e]={id:r,nd:t},0}function ds(e,t,r,o){e>>>=0,t>>>=0,r>>>=0,o>>>=0;var u=new Date().getFullYear(),l=new Date(u,0,1).getTimezoneOffset();u=new Date(u,6,1).getTimezoneOffset();var m=Math.max(l,u);_()[e>>>2>>>0]=60*m,I()[t>>>2>>>0]=+(l!=u),e=(t=y=>{var w=Math.abs(y);return`UTC${0<=y?"-":"+"}${String(Math.floor(w/60)).padStart(2,"0")}${String(w%60).padStart(2,"0")}`})(l),t=t(u),u<l?(Ne(e,r,17),Ne(t,o,17)):(Ne(e,o,17),Ne(t,r,17))}var ps=()=>Date.now(),ms=1;function ys(e,t,r){if(!(0<=e&&3>=e))return 28;if(e===0)e=Date.now();else{if(!ms)return 52;e=performance.timeOrigin+performance.now()}return ie[r>>>0>>>3]=BigInt(Math.round(1e6*e)),0}var Or=[],ni=(e,t)=>{Or.length=0;for(var r;r=ae()[e++>>>0];){var o=r!=105;t+=(o&=r!=112)&&t%8?4:0,Or.push(r==112?_()[t>>>2>>>0]:r==106?ie[t>>>3]:r==105?I()[t>>>2>>>0]:de()[t>>>3>>>0]),t+=o?8:4}return Or};function hs(e,t,r){return e>>>=0,t=ni(t>>>0,r>>>0),Dr[e](...t)}function bs(e,t,r){return e>>>=0,t=ni(t>>>0,r>>>0),Dr[e](...t)}var gs=()=>{};function ws(e,t){return N(ct(e>>>0,t>>>0))}var vs=()=>{throw K+=1,"unwind"};function Ts(){return 4294901760}var Cs=()=>1,Es=()=>navigator.hardwareConcurrency;function _s(){return Re("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Ss(e){e>>>=0;var t=ae().length;if(e<=t||4294901760<e)return!1;for(var r=1;4>=r;r*=2){var o=t*(1+.2/r);o=Math.min(o,e+100663296);e:{o=(Math.min(4294901760,65536*Math.ceil(Math.max(e,o)/65536))-R.buffer.byteLength+65535)/65536|0;try{R.grow(o),V();var u=1;break e}catch{}u=void 0}if(u)return!0}return!1}var Wt=()=>(Re("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),pt={},ii=e=>{e.forEach(t=>{var r=Wt();r&&(pt[r]=t)})};function As(){var e=Error().stack.toString().split(`
`);return e[0]=="Error"&&e.shift(),ii(e),pt.oc=Wt(),pt.Xc=e,pt.oc}function xs(e,t,r){if(e>>>=0,t>>>=0,pt.oc==e)var o=pt.Xc;else(o=Error().stack.toString().split(`
`))[0]=="Error"&&o.shift(),ii(o);for(var u=3;o[u]&&Wt()!=e;)++u;for(e=0;e<r&&o[e+u];++e)I()[t+4*e>>>2>>>0]=Wt();return e}var je=e=>{var t=Fe(e)+1,r=jt(t);return Ne(e,r,t),r},Lr=[],me=(e,t)=>{Lr[e>>>=0]=t},Ue=[],kt=[],Ct=(e,t)=>{kt[e]=new Promise(r=>t.finally(()=>r(e)))},B=e=>{if(e)return Lr[e>>>0]},Nt=(e,t,r)=>{_()[e>>>2>>>0]=t,_()[e+4>>>2>>>0]=r},oi=e=>{var t=_()[e>>>2>>>0];return e=_()[e+4>>>2>>>0],ct(t,e)},Ge=e=>{var t=_()[e>>>2>>>0];return e=_()[e+4>>>2>>>0],t?ct(t,e):e===0?"":void 0},ai=(e,t)=>{function r(u,l){u=e[u],I()[t+l>>>2>>>0]=u}function o(u,l){ie[t+l>>>3]=BigInt(e[u])}r("maxTextureDimension1D",4),r("maxTextureDimension2D",8),r("maxTextureDimension3D",12),r("maxTextureArrayLayers",16),r("maxBindGroups",20),r("maxBindGroupsPlusVertexBuffers",24),r("maxBindingsPerBindGroup",28),r("maxDynamicUniformBuffersPerPipelineLayout",32),r("maxDynamicStorageBuffersPerPipelineLayout",36),r("maxSampledTexturesPerShaderStage",40),r("maxSamplersPerShaderStage",44),r("maxStorageBuffersPerShaderStage",48),r("maxStorageTexturesPerShaderStage",52),r("maxUniformBuffersPerShaderStage",56),r("minUniformBufferOffsetAlignment",80),r("minStorageBufferOffsetAlignment",84),o("maxUniformBufferBindingSize",64),o("maxStorageBufferBindingSize",72),r("maxVertexBuffers",88),o("maxBufferSize",96),r("maxVertexAttributes",104),r("maxVertexBufferArrayStride",108),r("maxInterStageShaderVariables",112),r("maxColorAttachments",116),r("maxColorAttachmentBytesPerSample",120),r("maxComputeWorkgroupStorageSize",124),r("maxComputeInvocationsPerWorkgroup",128),r("maxComputeWorkgroupSizeX",132),r("maxComputeWorkgroupSizeY",136),r("maxComputeWorkgroupSizeZ",140),r("maxComputeWorkgroupsPerDimension",144),e.kd!==void 0&&r("maxImmediateSize",148)},Is={undefined:1,pd:1,gd:2},Os={1:"validation",2:"out-of-memory",3:"internal"},Ls=[,"compatibility","core"],Br={1:"depth-clip-control",2:"depth32float-stencil8",3:"timestamp-query",4:"texture-compression-bc",5:"texture-compression-bc-sliced-3d",6:"texture-compression-etc2",7:"texture-compression-astc",8:"texture-compression-astc-sliced-3d",9:"indirect-first-instance",10:"shader-f16",11:"rg11b10ufloat-renderable",12:"bgra8unorm-storage",13:"float32-filterable",14:"float32-blendable",15:"clip-distances",16:"dual-source-blending",17:"subgroups",18:"core-features-and-limits",327692:"chromium-experimental-unorm16-texture-formats",327693:"chromium-experimental-snorm16-texture-formats",327732:"chromium-experimental-multi-draw-indirect"},Bs=[,"low-power","high-performance"],Ms={1:"occlusion",2:"timestamp"},Us={"depth-clip-control":"1","depth32float-stencil8":"2","timestamp-query":"3","texture-compression-bc":"4","texture-compression-bc-sliced-3d":"5","texture-compression-etc2":"6","texture-compression-astc":"7","texture-compression-astc-sliced-3d":"8","indirect-first-instance":"9","shader-f16":"10","rg11b10ufloat-renderable":"11","bgra8unorm-storage":"12","float32-filterable":"13","float32-blendable":"14","clip-distances":"15","dual-source-blending":"16",md:"17","core-features-and-limits":"18","chromium-experimental-unorm16-texture-formats":"327692","chromium-experimental-snorm16-texture-formats":"327693","chromium-experimental-multi-draw-indirect":"327732"};function Ds(e,t,r,o,u,l){t=he(t),r=he(r),o>>>=0,u>>>=0,l>>>=0,e=B(e>>>0);var m={};if(l){var y=_()[l+12>>>2>>>0];if(y){var w=_()[l+16>>>2>>>0];m.requiredFeatures=Array.from(_().subarray(w>>>2>>>0,w+4*y>>>2>>>0),x=>Br[x])}var E=_()[l+20>>>2>>>0];if(E){let x=function(ee,Y,Ie=!1){Y=E+Y,(Y=_()[Y>>>2>>>0])==4294967295||Ie&&Y==0||(A[ee]=Y)},H=function(ee,Y){Y=E+Y;var Ie=_()[Y>>>2>>>0],Ke=_()[Y+4>>>2>>>0];Ie==4294967295&&Ke==4294967295||(A[ee]=4294967296*_()[Y+4>>>2>>>0]+_()[Y>>>2>>>0])};var O=x,k=H,A={};x("maxTextureDimension1D",4),x("maxTextureDimension2D",8),x("maxTextureDimension3D",12),x("maxTextureArrayLayers",16),x("maxBindGroups",20),x("maxBindGroupsPlusVertexBuffers",24),x("maxDynamicUniformBuffersPerPipelineLayout",32),x("maxDynamicStorageBuffersPerPipelineLayout",36),x("maxSampledTexturesPerShaderStage",40),x("maxSamplersPerShaderStage",44),x("maxStorageBuffersPerShaderStage",48),x("maxStorageTexturesPerShaderStage",52),x("maxUniformBuffersPerShaderStage",56),x("minUniformBufferOffsetAlignment",80),x("minStorageBufferOffsetAlignment",84),H("maxUniformBufferBindingSize",64),H("maxStorageBufferBindingSize",72),x("maxVertexBuffers",88),H("maxBufferSize",96),x("maxVertexAttributes",104),x("maxVertexBufferArrayStride",108),x("maxInterStageShaderVariables",112),x("maxColorAttachments",116),x("maxColorAttachmentBytesPerSample",120),x("maxComputeWorkgroupStorageSize",124),x("maxComputeInvocationsPerWorkgroup",128),x("maxComputeWorkgroupSizeX",132),x("maxComputeWorkgroupSizeY",136),x("maxComputeWorkgroupSizeZ",140),x("maxComputeWorkgroupsPerDimension",144),x("maxImmediateSize",148,!0),m.requiredLimits=A}(y=_()[l+24>>>2>>>0])&&(y={label:Ge(y+4)},m.defaultQueue=y),m.label=Ge(l+4)}K+=1,Ct(t,e.requestDevice(m).then(x=>{--K,me(u,x.queue),me(o,x),r&&(K+=1,Ct(r,x.lost.then(H=>{--K,x.onuncapturederror=()=>{};var ee=_e(),Y=je(H.message);Wr(r,Is[H.reason],Y),Ee(ee)}))),x.onuncapturederror=H=>{var ee=5;H.error instanceof GPUValidationError?ee=2:H.error instanceof GPUOutOfMemoryError?ee=3:H.error instanceof GPUInternalError&&(ee=4);var Y=_e();H=je(H.error.message),Oi(o,ee,H),Ee(Y)},Fr(t,1,o,0)},x=>{--K;var H=_e();x=je(x.message),Fr(t,3,o,x),r&&Wr(r,4,x),Ee(H)}))}function Ps(e){var t=B(e>>>=0),r=Ue[e];if(r){for(var o=0;o<r.length;++o)r[o]();delete Ue[e]}t.destroy()}var mt=()=>{var e="getMappedRange size=0 no longer means WGPU_WHOLE_MAP_SIZE";mt.kc||(mt.kc={}),mt.kc[e]||(mt.kc[e]=1,N(e))};function Rs(e,t,r){t>>>=0,r>>>=0;var o=B(e>>>=0);r===0&&mt(),r==4294967295&&(r=void 0);try{var u=o.getMappedRange(t,r)}catch{return 0}var l=$r(16,u.byteLength);return ae().set(new Uint8Array(u),l>>>0),Ue[e].push(()=>xe(l)),l}function Ws(e,t,r){t>>>=0,r>>>=0;var o=B(e>>>=0);r===0&&mt(),r==4294967295&&(r=void 0);try{var u=o.getMappedRange(t,r)}catch{return 0}var l=$r(16,u.byteLength);return ae().fill(0,l,u.byteLength),Ue[e].push(()=>{new Uint8Array(u).set(ae().subarray(l>>>0,l+u.byteLength>>>0)),xe(l)}),l}function ks(e,t,r,o,u){e>>>=0,t=he(t),r=he(r),u>>>=0;var l=B(e);Ue[e]=[],u==4294967295&&(u=void 0),K+=1,Ct(t,l.mapAsync(r,o>>>0,u).then(()=>{--K,kr(t,1,0)},m=>{--K,_e();var y=je(m.message);kr(t,m.name==="AbortError"?4:m.name==="OperationError"?3:0,y),delete Ue[e]}))}function Ns(e){var t=B(e>>>=0),r=Ue[e];if(r){for(var o=0;o<r.length;++o)r[o]();delete Ue[e],t.unmap()}}function Fs(e){delete Lr[e>>>0]}function js(e,t,r){e>>>=0,t>>>=0,r>>>=0;var o=!!_()[t+32>>>2>>>0];t={label:Ge(t+4),usage:_()[t+16>>>2>>>0],size:4294967296*_()[t+28>>>2>>>0]+_()[t+24>>>2>>>0],mappedAtCreation:o},e=B(e);try{var u=e.createBuffer(t)}catch{return!1}return me(r,u),o&&(Ue[r]=[]),!0}function Gs(e,t,r){e>>>=0,t>>>=0,r>>>=0;var o=_()[t>>>2>>>0],u=_()[o+4>>>2>>>0];t={label:Ge(t+4),code:""},u===2&&(t.code=oi(o+8)),me(r,B(e).createShaderModule(t))}var $s=e=>{B(e).destroy()};function zs(e,t){t=he(t),e=B(e>>>0),K+=1,Ct(t,e.popErrorScope().then(r=>{--K;var o=5;r?r instanceof GPUValidationError?o=2:r instanceof GPUOutOfMemoryError?o=3:r instanceof GPUInternalError&&(o=4):o=1;var u=_e();r=r?je(r.message):0,Nr(t,1,o,r),Ee(u)},r=>{--K;var o=_e();r=je(r.message),Nr(t,1,5,r),Ee(o)}))}function Vs(e,t,r,o){if(t=he(t),o>>>=0,r>>>=0){var u=_()[r+4>>>2>>>0];u={featureLevel:Ls[u],powerPreference:Bs[_()[r+8>>>2>>>0]],forceFallbackAdapter:!!_()[r+12>>>2>>>0]},(r=_()[r>>>2>>>0])!==0&&(_(),u.rd=!!_()[r+8>>>2>>>0])}"gpu"in navigator?(K+=1,Ct(t,navigator.gpu.requestAdapter(u).then(l=>{if(--K,l)me(o,l),Et(t,1,o,0);else{l=_e();var m=je("WebGPU not available on this browser (requestAdapter returned null)");Et(t,3,o,m),Ee(l)}},l=>{--K;var m=_e();l=je(l.message),Et(t,4,o,l),Ee(m)}))):(r=_e(),u=je("WebGPU not available on this browser (navigator.gpu is not available)"),Et(t,3,o,u),Ee(r))}function Hs(e,t,r){return e>>>=0,t>>>=0,r>>>=0,Jn(async()=>{var o=[];if(r){var u=I()[r>>>2>>>0];o.length=t+1,o[t]=new Promise(y=>setTimeout(y,u,0))}else o.length=t;for(var l=0;l<t;++l){var m=4294967296*_()[e+8*l+4>>>2>>>0]+_()[e+8*l>>>2>>>0];if(!(m in kt))return m;o[l]=kt[m]}return o=await Promise.race(o),delete kt[o],o})}var Mr,Ur={},si=()=>{if(!Mr){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in Ur)Ur[e]===void 0?delete t[e]:t[e]=Ur[e];var r=[];for(e in t)r.push(`${e}=${t[e]}`);Mr=r}return Mr};function ui(e,t){if(c)return J(19,1,e,t);e>>>=0,t>>>=0;var r,o=0,u=0;for(r of si()){var l=t+o;_()[e+u>>>2>>>0]=l,o+=Ne(r,l,1/0)+1,u+=4}return 0}function fi(e,t){if(c)return J(20,1,e,t);e>>>=0,t>>>=0;var r=si();for(var o of(_()[e>>>2>>>0]=r.length,e=0,r))e+=Fe(o)+1;return _()[t>>>2>>>0]=e,0}function li(e){return c?J(21,1,e):52}function ci(e,t,r,o){return c?J(22,1,e,t,r,o):52}function di(e,t,r,o){return c?J(23,1,e,t,r,o):70}var Ys=[null,[],[]];function pi(e,t,r,o){if(c)return J(24,1,e,t,r,o);t>>>=0,r>>>=0,o>>>=0;for(var u=0,l=0;l<r;l++){var m=_()[t>>>2>>>0],y=_()[t+4>>>2>>>0];t+=8;for(var w=0;w<y;w++){var E=e,A=ae()[m+w>>>0],O=Ys[E];A===0||A===10?((E===1?lt:N)(In(O)),O.length=0):O.push(A)}u+=y}return _()[o>>>2>>>0]=u,0}function qs(e,t){return ai(B(e>>>0).limits,t>>>0),1}function Js(e,t){return B(e>>>0).features.has(Br[t])}function Xs(e){return BigInt(B(e>>>0).size)}function Zs(e){return BigInt(B(e>>>0).usage)}function Qs(e,t){if(e>>>=0,t>>>=0){var r=Ge(t+4);r={label:r,timestampWrites:t=(t=_()[t+12>>>2>>>0])!==0?{querySet:B(_()[t+4>>>2>>>0]),beginningOfPassWriteIndex:_()[t+8>>>2>>>0],endOfPassWriteIndex:_()[t+12>>>2>>>0]}:void 0}}return e=B(e),t=Ei(0),me(t,e.beginComputePass(r)),t}function Ks(e,t,r,o,u,l){r=he(r),u=he(u),l=he(l),B(e>>>0).copyBufferToBuffer(B(t>>>0),r,B(o>>>0),u,l)}function eu(e){e=B(e>>>0);var t=Ti(0);return me(t,e.finish()),t}function tu(e,t,r,o,u,l){l=he(l),B(e>>>0).resolveQuerySet(B(t>>>0),r,o,B(u>>>0),l)}function ru(e,t,r,o){B(e>>>0).dispatchWorkgroups(t,r,o)}function nu(e){B(e>>>0).end()}function iu(e,t,r,o,u){o>>>=0,u>>>=0,e=B(e>>>0),r=B(r>>>0),o==0?e.setBindGroup(t,r):e.setBindGroup(t,r,_(),u>>>2,o)}function ou(e,t){B(e>>>0).setPipeline(B(t>>>0))}function au(e,t,r){B(e>>>0).qd(B(t>>>0),r)}function su(e,t){e=B(e>>>0);var r=vi(0);return me(r,e.getBindGroupLayout(t)),r}function uu(e,t){e>>>=0;var r=Ge(4+(t>>>=0)),o=B(_()[t+12>>>2>>>0]),u=_()[t+16>>>2>>>0];t=_()[t+20>>>2>>>0];for(var l=[],m=0;m<u;++m){var y=l,w=y.push,E=t+40*m,A=_()[E+8>>>2>>>0],O=_()[E+32>>>2>>>0],k=_()[E+36>>>2>>>0],x=_()[E+4>>>2>>>0];A?(O=E+24,(O=_()[O>>>2>>>0]+4294967296*I()[O+4>>>2>>>0])==-1&&(O=void 0),E={binding:x,resource:{buffer:B(A),offset:4294967296*_()[E+4+16>>>2>>>0]+_()[E+16>>>2>>>0],size:O}}):E=O?{binding:x,resource:B(O)}:{binding:x,resource:B(k)},w.call(y,E)}return r={label:r,layout:o,entries:l},e=B(e),o=wi(0),me(o,e.createBindGroup(r)),o}function fu(e,t){var r;return e>>>=0,(t>>>=0)&&(r={label:Ge(t+4)}),e=B(e),t=Ci(0),me(t,e.createCommandEncoder(r)),t}function lu(e,t){e>>>=0;var r=t>>>0;t=Ge(r+4);var o=(o=_()[r+12>>>2>>>0])?B(o):"auto";if(r+=16){var u=B(_()[r+4>>>2>>>0]),l=_()[r+16>>>2>>>0],m=_()[r+20>>>2>>>0];if(l){for(var y={},w=0;w<l;++w){var E=m+24*w;y[oi(E+4)]=de()[E+16>>>3>>>0]}l=y}else l=void 0;r={module:u,constants:l,entryPoint:Ge(r+8)}}else r=void 0;return t={label:t,layout:o,compute:r},e=B(e),o=_i(0),me(o,e.createComputePipeline(t)),o}function cu(e,t){e>>>=0,t>>>=0,t={type:Ms[_()[t+12>>>2>>>0]],count:_()[t+16>>>2>>>0]},e=B(e);var r=Si(0);return me(r,e.createQuerySet(t)),r}function du(e,t){e=B(e>>>0).adapterInfo,t>>>=0,I()[t+52>>>2>>>0]=e.subgroupMinSize,I()[t+56>>>2>>>0]=e.subgroupMaxSize;var r=e.vendor+e.architecture+e.device+e.description,o=Fe(r)+1,u=yt(o);return u&&Ne(r,u,o),r=u,o=Fe(e.vendor),Nt(t+4,r,o),r+=o,o=Fe(e.architecture),Nt(t+12,r,o),r+=o,o=Fe(e.device),Nt(t+20,r,o),Nt(t+28,r+o,Fe(e.description)),I()[t+36>>>2>>>0]=2,e=e.isFallbackAdapter?3:4,I()[t+40>>>2>>>0]=e,I()[t+44>>>2>>>0]=0,I()[t+48>>>2>>>0]=0,1}function pu(e,t){t>>>=0,e=B(e>>>0);var r=yt(4*e.features.size),o=0,u=0;e.features.forEach(l=>{(l=Us[l])!==void 0&&(I()[r+o>>>2>>>0]=l,o+=4,u++)}),_()[t+4>>>2>>>0]=r,_()[t>>>2>>>0]=u}function mu(e,t){return ai(B(e>>>0).limits,t>>>0),1}function yu(e,t){return B(e>>>0).features.has(Br[t])}function hu(e,t){B(e>>>0).pushErrorScope(Os[t])}function bu(e,t,r){t>>>=0,r>>>=0,e=B(e>>>0),t=Array.from(I().subarray(r>>>2>>>0,r+4*t>>>2>>>0),o=>B(o)),e.submit(t)}function gu(e,t,r,o,u){r=he(r),o>>>=0,u>>>=0,e=B(e>>>0),t=B(t>>>0),o=ae().subarray(o>>>0,o+u>>>0),e.writeBuffer(t,r,o,0,u)}c||function(){for(var e=n.numThreads-1;e--;)_n();br.push(()=>{Ae++,function(t){c?t():Promise.all(ze.map(En)).then(t)}(()=>yr())})}();for(var mi=Array(256),Ft=0;256>Ft;++Ft)mi[Ft]=String.fromCharCode(Ft);Gn=mi,ke.push(0,1,void 0,1,null,1,!0,1,!1,1),n.count_emval_handles=()=>ke.length/2-5-Cr.length,c||(R=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),V()),n.wasmBinary&&(D=n.wasmBinary),n.stackSave=()=>_e(),n.stackRestore=e=>Ee(e),n.stackAlloc=e=>jt(e),n.setValue=function(e,t,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":case"i8":re()[e>>>0]=t;break;case"i16":Le()[e>>>1>>>0]=t;break;case"i32":I()[e>>>2>>>0]=t;break;case"i64":ie[e>>>3]=BigInt(t);break;case"float":ve()[e>>>2>>>0]=t;break;case"double":de()[e>>>3>>>0]=t;break;case"*":_()[e>>>2>>>0]=t;break;default:Re(`invalid type for setValue: ${r}`)}},n.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return re()[e>>>0];case"i16":return Le()[e>>>1>>>0];case"i32":return I()[e>>>2>>>0];case"i64":return ie[e>>>3];case"float":return ve()[e>>>2>>>0];case"double":return de()[e>>>3>>>0];case"*":return _()[e>>>2>>>0];default:Re(`invalid type for getValue: ${t}`)}},n.UTF8ToString=ct,n.stringToUTF8=Ne,n.lengthBytesUTF8=Fe;var wu=[gr,wn,Sn,On,Ln,Bn,Mn,Un,Dn,Pn,Rn,Wn,kn,Nn,Fn,jn,ei,ti,ri,ui,fi,li,ci,di,pi],Dr={1046876:(e,t,r,o,u)=>{if(n===void 0||!n.fc)return 1;if((e=ct(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=n.fc.get(e)))return 2;if(t=Number(t>>>0),r=Number(r>>>0),o=Number(o>>>0),t+r>e.byteLength)return 3;try{let l=e.subarray(t,t+r);switch(u){case 0:ae().set(l,o>>>0);break;case 1:n.Pc?n.Pc(o,l):n.jd(o,l);break;default:return 4}return 0}catch{return 4}},1047700:(e,t,r)=>{n.Rc(e,ae().subarray(t>>>0,t+r>>>0))},1047764:()=>n.ed(),1047806:e=>{n.Qc(e)},1047843:()=>typeof wasmOffsetConverter<"u"};function vu(){return typeof wasmOffsetConverter<"u"}var b=await async function(){function e(o,u){return b=o.exports,b=function(){var l=b,m={};for(let[y,w]of Object.entries(l))m[y]=typeof w=="function"?(...E)=>{Dt.push(y);try{return w(...E)}finally{ue||(Dt.pop(),Me&&He===1&&Dt.length===0&&(He=0,K+=1,Ut(ki),typeof Fibers<"u"&&Fibers.od()))}}:w;return m}(),b=function(){var l=b,m=w=>E=>w(E)>>>0,y=w=>()=>w()>>>0;return(l=Object.assign({},l)).ob=m(l.ob),l.Rb=y(l.Rb),l.Tb=m(l.Tb),l.Dc=(w=>(E,A)=>w(E,A)>>>0)(l.Dc),l.Gc=m(l.Gc),l.Hc=y(l.Hc),l.__cxa_get_exception_ptr=m(l.__cxa_get_exception_ptr),l}(),vn.push(b.vc),M=u,yr(),b}Ae++;var t=hn();if(n.instantiateWasm)return new Promise(o=>{n.instantiateWasm(t,(u,l)=>{o(e(u,l))})});if(c)return new Promise(o=>{wt=u=>{var l=new WebAssembly.Instance(u,hn());o(e(l,u))}});Te??=n.locateFile?n.locateFile?n.locateFile("ort-wasm-simd-threaded.asyncify.wasm",U):U+"ort-wasm-simd-threaded.asyncify.wasm":new URL("ort-wasm-simd-threaded.asyncify.wasm",import.meta.url).href;try{var r=await async function(o){var u=Te;if(!D&&typeof WebAssembly.instantiateStreaming=="function"&&!Z(u))try{var l=fetch(u,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(l,o)}catch(m){N(`wasm streaming compile failed: ${m}`),N("falling back to ArrayBuffer instantiation")}return async function(m,y){try{var w=await async function(E){if(!D)try{var A=await v(E);return new Uint8Array(A)}catch{}if(E==Te&&D)E=new Uint8Array(D);else{if(!C)throw"both async and sync fetching of the wasm failed";E=C(E)}return E}(m);return await WebAssembly.instantiate(w,y)}catch(E){N(`failed to asynchronously prepare wasm: ${E}`),Re(E)}}(u,o)}(t);return e(r.instance,r.module)}catch(o){return s(o),Promise.reject(o)}}(),yi=e=>(yi=b.ob)(e),hi=()=>(hi=b.pb)();n._OrtInit=(e,t)=>(n._OrtInit=b.qb)(e,t),n._OrtGetLastError=(e,t)=>(n._OrtGetLastError=b.rb)(e,t),n._OrtCreateSessionOptions=(e,t,r,o,u,l,m,y,w,E)=>(n._OrtCreateSessionOptions=b.sb)(e,t,r,o,u,l,m,y,w,E),n._OrtAppendExecutionProvider=(e,t,r,o,u)=>(n._OrtAppendExecutionProvider=b.tb)(e,t,r,o,u),n._OrtAddFreeDimensionOverride=(e,t,r)=>(n._OrtAddFreeDimensionOverride=b.ub)(e,t,r),n._OrtAddSessionConfigEntry=(e,t,r)=>(n._OrtAddSessionConfigEntry=b.vb)(e,t,r),n._OrtReleaseSessionOptions=e=>(n._OrtReleaseSessionOptions=b.wb)(e),n._OrtCreateSession=(e,t,r)=>(n._OrtCreateSession=b.xb)(e,t,r),n._OrtReleaseSession=e=>(n._OrtReleaseSession=b.yb)(e),n._OrtGetInputOutputCount=(e,t,r)=>(n._OrtGetInputOutputCount=b.zb)(e,t,r),n._OrtGetInputOutputMetadata=(e,t,r,o)=>(n._OrtGetInputOutputMetadata=b.Ab)(e,t,r,o),n._OrtFree=e=>(n._OrtFree=b.Bb)(e),n._OrtCreateTensor=(e,t,r,o,u,l)=>(n._OrtCreateTensor=b.Cb)(e,t,r,o,u,l),n._OrtGetTensorData=(e,t,r,o,u)=>(n._OrtGetTensorData=b.Db)(e,t,r,o,u),n._OrtReleaseTensor=e=>(n._OrtReleaseTensor=b.Eb)(e),n._OrtCreateRunOptions=(e,t,r,o)=>(n._OrtCreateRunOptions=b.Fb)(e,t,r,o),n._OrtAddRunConfigEntry=(e,t,r)=>(n._OrtAddRunConfigEntry=b.Gb)(e,t,r),n._OrtReleaseRunOptions=e=>(n._OrtReleaseRunOptions=b.Hb)(e),n._OrtCreateBinding=e=>(n._OrtCreateBinding=b.Ib)(e),n._OrtBindInput=(e,t,r)=>(n._OrtBindInput=b.Jb)(e,t,r),n._OrtBindOutput=(e,t,r,o)=>(n._OrtBindOutput=b.Kb)(e,t,r,o),n._OrtClearBoundOutputs=e=>(n._OrtClearBoundOutputs=b.Lb)(e),n._OrtReleaseBinding=e=>(n._OrtReleaseBinding=b.Mb)(e),n._OrtRunWithBinding=(e,t,r,o,u)=>(n._OrtRunWithBinding=b.Nb)(e,t,r,o,u),n._OrtRun=(e,t,r,o,u,l,m,y)=>(n._OrtRun=b.Ob)(e,t,r,o,u,l,m,y),n._OrtEndProfiling=e=>(n._OrtEndProfiling=b.Pb)(e);var Pr=n._OrtGetWebGpuDevice=e=>(Pr=n._OrtGetWebGpuDevice=b.Qb)(e),Rr=()=>(Rr=b.Rb)(),xe=n._free=e=>(xe=n._free=b.Sb)(e),yt=n._malloc=e=>(yt=n._malloc=b.Tb)(e),bi=n._wgpuBufferRelease=e=>(bi=n._wgpuBufferRelease=b.Ub)(e),gi=n._wgpuCreateInstance=e=>(gi=n._wgpuCreateInstance=b.Vb)(e),wi=e=>(wi=b.Wb)(e),vi=e=>(vi=b.Xb)(e),Ti=e=>(Ti=b.Yb)(e),Ci=e=>(Ci=b.Zb)(e),Ei=e=>(Ei=b._b)(e),_i=e=>(_i=b.$b)(e),Si=e=>(Si=b.bc)(e),Ai=(e,t)=>(Ai=b.lc)(e,t),xi=(e,t)=>(xi=b.mc)(e,t),Ii=e=>(Ii=b.nc)(e),Wr=(e,t,r)=>(Wr=b.pc)(e,t,r),kr=(e,t,r)=>(kr=b.qc)(e,t,r),Nr=(e,t,r,o)=>(Nr=b.rc)(e,t,r,o),Et=(e,t,r,o)=>(Et=b.sc)(e,t,r,o),Fr=(e,t,r,o)=>(Fr=b.tc)(e,t,r,o),Oi=(e,t,r)=>(Oi=b.uc)(e,t,r),jr=(e,t,r,o,u,l)=>(jr=b.wc)(e,t,r,o,u,l),Li=()=>(Li=b.xc)(),Bi=(e,t,r,o,u)=>(Bi=b.yc)(e,t,r,o,u),Mi=e=>(Mi=b.zc)(e),Gr=e=>(Gr=b.Ac)(e),Ui=(e,t)=>(Ui=b.Bc)(e,t),Di=()=>(Di=b.Cc)(),$r=(e,t)=>($r=b.Dc)(e,t),Pi=(e,t)=>(Pi=b.Ec)(e,t),Ee=e=>(Ee=b.Fc)(e),jt=e=>(jt=b.Gc)(e),_e=()=>(_e=b.Hc)(),Ri=n.dynCall_ii=(e,t)=>(Ri=n.dynCall_ii=b.Ic)(e,t);n.dynCall_viiii=(e,t,r,o,u)=>(n.dynCall_viiii=b.dynCall_viiii)(e,t,r,o,u),n.dynCall_viiiii=(e,t,r,o,u,l)=>(n.dynCall_viiiii=b.dynCall_viiiii)(e,t,r,o,u,l),n.dynCall_viii=(e,t,r,o)=>(n.dynCall_viii=b.Jc)(e,t,r,o),n.dynCall_vi=(e,t)=>(n.dynCall_vi=b.dynCall_vi)(e,t),n.dynCall_viijj=(e,t,r,o,u)=>(n.dynCall_viijj=b.dynCall_viijj)(e,t,r,o,u),n.dynCall_viiiiii=(e,t,r,o,u,l,m)=>(n.dynCall_viiiiii=b.dynCall_viiiiii)(e,t,r,o,u,l,m),n.dynCall_viiiiiiii=(e,t,r,o,u,l,m,y,w)=>(n.dynCall_viiiiiiii=b.dynCall_viiiiiiii)(e,t,r,o,u,l,m,y,w),n.dynCall_i=e=>(n.dynCall_i=b.dynCall_i)(e),n.dynCall_vii=(e,t,r)=>(n.dynCall_vii=b.dynCall_vii)(e,t,r),n.dynCall_fffffff=(e,t,r,o,u,l,m)=>(n.dynCall_fffffff=b.dynCall_fffffff)(e,t,r,o,u,l,m),n.dynCall_iiiii=(e,t,r,o,u)=>(n.dynCall_iiiii=b.dynCall_iiiii)(e,t,r,o,u),n.dynCall_iii=(e,t,r)=>(n.dynCall_iii=b.dynCall_iii)(e,t,r),n.dynCall_iiiiii=(e,t,r,o,u,l)=>(n.dynCall_iiiiii=b.dynCall_iiiiii)(e,t,r,o,u,l),n.dynCall_iiiiiiii=(e,t,r,o,u,l,m,y)=>(n.dynCall_iiiiiiii=b.dynCall_iiiiiiii)(e,t,r,o,u,l,m,y),n.dynCall_iiiiiii=(e,t,r,o,u,l,m)=>(n.dynCall_iiiiiii=b.dynCall_iiiiiii)(e,t,r,o,u,l,m),n.dynCall_iiii=(e,t,r,o)=>(n.dynCall_iiii=b.dynCall_iiii)(e,t,r,o),n.dynCall_vfiii=(e,t,r,o,u)=>(n.dynCall_vfiii=b.dynCall_vfiii)(e,t,r,o,u),n.dynCall_viiiiff=(e,t,r,o,u,l,m)=>(n.dynCall_viiiiff=b.dynCall_viiiiff)(e,t,r,o,u,l,m),n.dynCall_viiiiiff=(e,t,r,o,u,l,m,y)=>(n.dynCall_viiiiiff=b.dynCall_viiiiiff)(e,t,r,o,u,l,m,y),n.dynCall_ffff=(e,t,r,o)=>(n.dynCall_ffff=b.dynCall_ffff)(e,t,r,o),n.dynCall_viiff=(e,t,r,o,u)=>(n.dynCall_viiff=b.dynCall_viiff)(e,t,r,o,u),n.dynCall_jjjjjjj=(e,t,r,o,u,l,m)=>(n.dynCall_jjjjjjj=b.dynCall_jjjjjjj)(e,t,r,o,u,l,m),n.dynCall_jjjjjj=(e,t,r,o,u,l)=>(n.dynCall_jjjjjj=b.dynCall_jjjjjj)(e,t,r,o,u,l),n.dynCall_iijjii=(e,t,r,o,u,l)=>(n.dynCall_iijjii=b.dynCall_iijjii)(e,t,r,o,u,l),n.dynCall_viiiiiiiiiiiii=(e,t,r,o,u,l,m,y,w,E,A,O,k,x)=>(n.dynCall_viiiiiiiiiiiii=b.dynCall_viiiiiiiiiiiii)(e,t,r,o,u,l,m,y,w,E,A,O,k,x),n.dynCall_viiiiiiiiii=(e,t,r,o,u,l,m,y,w,E,A)=>(n.dynCall_viiiiiiiiii=b.dynCall_viiiiiiiiii)(e,t,r,o,u,l,m,y,w,E,A),n.dynCall_viiiiiiiiiii=(e,t,r,o,u,l,m,y,w,E,A,O)=>(n.dynCall_viiiiiiiiiii=b.dynCall_viiiiiiiiiii)(e,t,r,o,u,l,m,y,w,E,A,O),n.dynCall_viiiiiiiiiiii=(e,t,r,o,u,l,m,y,w,E,A,O,k)=>(n.dynCall_viiiiiiiiiiii=b.dynCall_viiiiiiiiiiii)(e,t,r,o,u,l,m,y,w,E,A,O,k),n.dynCall_viiiiiiiiiiiiiiiiii=(e,t,r,o,u,l,m,y,w,E,A,O,k,x,H,ee,Y,Ie,Ke)=>(n.dynCall_viiiiiiiiiiiiiiiiii=b.dynCall_viiiiiiiiiiiiiiiiii)(e,t,r,o,u,l,m,y,w,E,A,O,k,x,H,ee,Y,Ie,Ke),n.dynCall_viiiiiiiii=(e,t,r,o,u,l,m,y,w,E)=>(n.dynCall_viiiiiiiii=b.dynCall_viiiiiiiii)(e,t,r,o,u,l,m,y,w,E),n.dynCall_viiiiiiiiiiiiiiiiiii=(e,t,r,o,u,l,m,y,w,E,A,O,k,x,H,ee,Y,Ie,Ke,zr)=>(n.dynCall_viiiiiiiiiiiiiiiiiii=b.dynCall_viiiiiiiiiiiiiiiiiii)(e,t,r,o,u,l,m,y,w,E,A,O,k,x,H,ee,Y,Ie,Ke,zr),n.dynCall_viiiiiii=(e,t,r,o,u,l,m,y)=>(n.dynCall_viiiiiii=b.dynCall_viiiiiii)(e,t,r,o,u,l,m,y),n.dynCall_viiiiiiiiiiiiiii=(e,t,r,o,u,l,m,y,w,E,A,O,k,x,H,ee)=>(n.dynCall_viiiiiiiiiiiiiii=b.dynCall_viiiiiiiiiiiiiii)(e,t,r,o,u,l,m,y,w,E,A,O,k,x,H,ee),n.dynCall_jiji=(e,t,r,o)=>(n.dynCall_jiji=b.dynCall_jiji)(e,t,r,o),n.dynCall_v=e=>(n.dynCall_v=b.dynCall_v)(e),n.dynCall_iidiiii=(e,t,r,o,u,l,m)=>(n.dynCall_iidiiii=b.dynCall_iidiiii)(e,t,r,o,u,l,m),n.dynCall_ji=(e,t)=>(n.dynCall_ji=b.dynCall_ji)(e,t),n.dynCall_vij=(e,t,r)=>(n.dynCall_vij=b.dynCall_vij)(e,t,r),n.dynCall_viiijii=(e,t,r,o,u,l,m)=>(n.dynCall_viiijii=b.dynCall_viiijii)(e,t,r,o,u,l,m),n.dynCall_viijiiiiiiiiiiiiii=(e,t,r,o,u,l,m,y,w,E,A,O,k,x,H,ee,Y,Ie)=>(n.dynCall_viijiiiiiiiiiiiiii=b.dynCall_viijiiiiiiiiiiiiii)(e,t,r,o,u,l,m,y,w,E,A,O,k,x,H,ee,Y,Ie),n.dynCall_viiiji=(e,t,r,o,u,l)=>(n.dynCall_viiiji=b.dynCall_viiiji)(e,t,r,o,u,l),n.dynCall_jfi=(e,t,r)=>(n.dynCall_jfi=b.dynCall_jfi)(e,t,r),n.dynCall_fif=(e,t,r)=>(n.dynCall_fif=b.dynCall_fif)(e,t,r),n.dynCall_jii=(e,t,r)=>(n.dynCall_jii=b.dynCall_jii)(e,t,r),n.dynCall_viiiijii=(e,t,r,o,u,l,m,y)=>(n.dynCall_viiiijii=b.dynCall_viiiijii)(e,t,r,o,u,l,m,y),n.dynCall_iij=(e,t,r)=>(n.dynCall_iij=b.dynCall_iij)(e,t,r),n.dynCall_viji=(e,t,r,o)=>(n.dynCall_viji=b.dynCall_viji)(e,t,r,o),n.dynCall_iiiiiiiii=(e,t,r,o,u,l,m,y,w)=>(n.dynCall_iiiiiiiii=b.dynCall_iiiiiiiii)(e,t,r,o,u,l,m,y,w),n.dynCall_iiij=(e,t,r,o)=>(n.dynCall_iiij=b.dynCall_iiij)(e,t,r,o),n.dynCall_iiiiiiiiii=(e,t,r,o,u,l,m,y,w,E)=>(n.dynCall_iiiiiiiiii=b.dynCall_iiiiiiiiii)(e,t,r,o,u,l,m,y,w,E),n.dynCall_iiiiiiiiiiiii=(e,t,r,o,u,l,m,y,w,E,A,O,k)=>(n.dynCall_iiiiiiiiiiiii=b.dynCall_iiiiiiiiiiiii)(e,t,r,o,u,l,m,y,w,E,A,O,k),n.dynCall_iiiiiiiiiii=(e,t,r,o,u,l,m,y,w,E,A)=>(n.dynCall_iiiiiiiiiii=b.dynCall_iiiiiiiiiii)(e,t,r,o,u,l,m,y,w,E,A),n.dynCall_iijii=(e,t,r,o,u)=>(n.dynCall_iijii=b.dynCall_iijii)(e,t,r,o,u),n.dynCall_fiii=(e,t,r,o)=>(n.dynCall_fiii=b.dynCall_fiii)(e,t,r,o),n.dynCall_viijii=(e,t,r,o,u,l)=>(n.dynCall_viijii=b.dynCall_viijii)(e,t,r,o,u,l),n.dynCall_viij=(e,t,r,o)=>(n.dynCall_viij=b.dynCall_viij)(e,t,r,o),n.dynCall_jiij=(e,t,r,o)=>(n.dynCall_jiij=b.dynCall_jiij)(e,t,r,o),n.dynCall_fi=(e,t)=>(n.dynCall_fi=b.dynCall_fi)(e,t),n.dynCall_fii=(e,t,r)=>(n.dynCall_fii=b.dynCall_fii)(e,t,r),n.dynCall_dii=(e,t,r)=>(n.dynCall_dii=b.dynCall_dii)(e,t,r),n.dynCall_fiiii=(e,t,r,o,u)=>(n.dynCall_fiiii=b.dynCall_fiiii)(e,t,r,o,u),n.dynCall_viiiiiiiiiiiiii=(e,t,r,o,u,l,m,y,w,E,A,O,k,x,H)=>(n.dynCall_viiiiiiiiiiiiii=b.dynCall_viiiiiiiiiiiiii)(e,t,r,o,u,l,m,y,w,E,A,O,k,x,H),n.dynCall_viiiiiiiiiiiiiiiiiiii=(e,t,r,o,u,l,m,y,w,E,A,O,k,x,H,ee,Y,Ie,Ke,zr,Tu)=>(n.dynCall_viiiiiiiiiiiiiiiiiiii=b.dynCall_viiiiiiiiiiiiiiiiiiii)(e,t,r,o,u,l,m,y,w,E,A,O,k,x,H,ee,Y,Ie,Ke,zr,Tu),n.dynCall_viiiiiiiiiiiiiiii=(e,t,r,o,u,l,m,y,w,E,A,O,k,x,H,ee,Y)=>(n.dynCall_viiiiiiiiiiiiiiii=b.dynCall_viiiiiiiiiiiiiiii)(e,t,r,o,u,l,m,y,w,E,A,O,k,x,H,ee,Y),n.dynCall_iif=(e,t,r)=>(n.dynCall_iif=b.dynCall_iif)(e,t,r),n.dynCall_jiiii=(e,t,r,o,u)=>(n.dynCall_jiiii=b.dynCall_jiiii)(e,t,r,o,u),n.dynCall_jiii=(e,t,r,o)=>(n.dynCall_jiii=b.dynCall_jiii)(e,t,r,o),n.dynCall_viif=(e,t,r,o)=>(n.dynCall_viif=b.dynCall_viif)(e,t,r,o),n.dynCall_viiij=(e,t,r,o,u)=>(n.dynCall_viiij=b.dynCall_viiij)(e,t,r,o,u),n.dynCall_iiiiij=(e,t,r,o,u,l)=>(n.dynCall_iiiiij=b.dynCall_iiiiij)(e,t,r,o,u,l),n.dynCall_iiiiid=(e,t,r,o,u,l)=>(n.dynCall_iiiiid=b.dynCall_iiiiid)(e,t,r,o,u,l),n.dynCall_iiiiijj=(e,t,r,o,u,l,m)=>(n.dynCall_iiiiijj=b.dynCall_iiiiijj)(e,t,r,o,u,l,m),n.dynCall_iiiiiijj=(e,t,r,o,u,l,m,y)=>(n.dynCall_iiiiiijj=b.dynCall_iiiiiijj)(e,t,r,o,u,l,m,y);var Wi=e=>(Wi=b.Kc)(e),ki=()=>(ki=b.Lc)(),Ni=e=>(Ni=b.Mc)(e),Fi=()=>(Fi=b.Nc)();return function e(){if(0<Ae)Pe=e;else if(c)i(n),q();else{for(;0<br.length;)br.shift()(n);0<Ae?Pe=e:(n.calledRun=!0,ue||(q(),i(n)))}}(),n.PTR_SIZE=4,n.webgpuInit=e=>{let t=new WeakMap,r,o,u=1;n.webgpuRegisterDevice=y=>{if(o!==void 0)throw Error("another WebGPU EP inference session is being created.");if(y){var w=t.get(y);if(!w){let E=((A,O=0)=>{var k=Ii(O);return O=xi(O,k),me(k,A.queue),me(O,A),O})(y,w=gi(0));w=[u++,w,E],t.set(y,w)}return r=y,o=w[0],w}r=void 0,o=0};let l=new Map;n.webgpuOnCreateSession=y=>{if(o!==void 0){var w=o;if(o=void 0,y){let E=Pr(w);l.set(y,E),w===0&&e(r??B(E))}r=void 0}},n.webgpuOnReleaseSession=y=>{l.delete(y)};let m=Symbol("gpuBufferMetadata");n.webgpuRegisterBuffer=(y,w,E)=>{if(E)return y[m]=[E,NaN],E;if(E=y[m])return E[1]++,E[0];if((w=l.get(w))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");return w=((A,O=0)=>(A.mapState!="pending"||Re(),O=Ai(O,A.mapState=="mapped"?3:1),me(O,A),A.mapState=="mapped"&&(Ue[O]=[]),O))(y,w),y[m]=[w,1],w},n.webgpuUnregisterBuffer=y=>{let w=y[m];if(!w)throw Error("Buffer is not registered");w[1]--,w[1]===0&&(bi(w[0]),delete y[m])},n.webgpuGetBuffer=y=>B(y),n.webgpuCreateDownloader=(y,w,E)=>{if((E=l.get(E))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");let A=B(E),O=16*Math.ceil(Number(w)/16);return async()=>{let k=A.createBuffer({size:O,usage:9});try{let x=A.createCommandEncoder();return x.copyBufferToBuffer(y,0,k,0,O),A.queue.submit([x.finish()]),await k.mapAsync(GPUMapMode.READ),k.getMappedRange().slice(0,w)}finally{k.destroy()}}},n.Pc=(y,w)=>{var E=w.buffer;let A=w.byteOffset,O=w.byteLength;if(w=16*Math.ceil(Number(O)/16),y=B(y),!r){var k=Pr(o);r=B(k)}let x=(k=r.createBuffer({mappedAtCreation:!0,size:w,usage:6})).getMappedRange();new Uint8Array(x).set(new Uint8Array(E,A,O)),k.unmap(),(E=r.createCommandEncoder()).copyBufferToBuffer(k,0,y,0,w),r.queue.submit([E.finish()]),k.destroy()}},n.webnnInit=e=>{let t=e[0];[n.ed,n.Qc,n.webnnEnsureTensor,n.Rc,n.webnnDownloadTensor,n.dd,n.webnnEnableTraceEvent]=e.slice(1),n.webnnReleaseTensorId=n.Qc,n.webnnUploadTensor=n.Rc,n.webnnRegisterMLContext=n.dd,n.webnnOnRunStart=r=>t.onRunStart(r),n.webnnOnRunEnd=t.onRunEnd.bind(t),n.webnnOnReleaseSession=r=>{t.onReleaseSession(r)},n.webnnCreateMLTensorDownloader=(r,o)=>t.createMLTensorDownloader(r,o),n.webnnRegisterMLTensor=(r,o,u,l)=>t.registerMLTensor(r,o,u,l),n.webnnCreateMLContext=r=>t.createMLContext(r),n.webnnRegisterMLConstant=(r,o,u,l,m,y)=>t.registerMLConstant(r,o,u,l,m,n.fc,y),n.webnnRegisterGraphInput=t.registerGraphInput.bind(t),n.webnnIsGraphInput=t.isGraphInput.bind(t),n.webnnRegisterGraphOutput=t.registerGraphOutput.bind(t),n.webnnIsGraphOutput=t.isGraphOutput.bind(t),n.webnnCreateTemporaryTensor=t.createTemporaryTensor.bind(t),n.webnnIsGraphInputOutputTypeSupported=t.isGraphInputOutputTypeSupported.bind(t)},f},Ou=Co,Lu=globalThis.self?.name?.startsWith("em-pthread");Lu&&Co()});var xo,tn,Bu,be,Io,en,Mu,Uu,Oo,Du,So,Lo,Ao,Bo,Yt=F(()=>{"use strict";Ht();xo=typeof location>"u"?void 0:location.origin,tn=import.meta.url>"file:"&&import.meta.url<"file;",Bu=()=>{if(!!1){if(tn){let a=URL;return new URL(new a("ort.webgpu.bundle.min.mjs",import.meta.url).href,xo).href}return import.meta.url}},be=Bu(),Io=()=>{if(be&&!be.startsWith("blob:"))return be.substring(0,be.lastIndexOf("/")+1)},en=(a,i)=>{try{let s=i??be;return(s?new URL(a,s):new URL(a)).origin===xo}catch{return!1}},Mu=(a,i)=>{let s=i??be;try{return(s?new URL(a,s):new URL(a)).href}catch{return}},Uu=(a,i)=>`${i??"./"}${a}`,Oo=async a=>{let s=await(await fetch(a,{credentials:"same-origin"})).blob();return URL.createObjectURL(s)},Du=async a=>(await import(/*webpackIgnore:true*/a)).default,So=(To(),Gt(vo)).default,Lo=async()=>{if(!be)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(en(be))return[void 0,So()];let a=await Oo(be);return[a,So(a)]},Ao=(_o(),Gt(Eo)).default,Bo=async(a,i,s,n)=>{let f=Ao&&!(a||i);if(f)if(be)f=en(be);else if(n&&!s)f=!0;else throw new Error("cannot determine the script source URL.");if(f)return[void 0,Ao];{let d="ort-wasm-simd-threaded.asyncify.mjs",p=a??Mu(d,i),c=!!1&&s&&p&&!en(p,i),h=c?await Oo(p):p??Uu(d,i);return[c?h:void 0,await Du(h)]}}});var rn,nn,rr,Mo,Pu,Ru,Wu,qt,G,Xe=F(()=>{"use strict";Yt();nn=!1,rr=!1,Mo=!1,Pu=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},Ru=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},Wu=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},qt=async a=>{if(nn)return Promise.resolve();if(rr)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Mo)throw new Error("previous call to 'initializeWebAssembly()' failed.");rr=!0;let i=a.initTimeout,s=a.numThreads;if(a.simd!==!1){if(a.simd==="relaxed"){if(!Wu())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!Ru())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let n=Pu();s>1&&!n&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+s+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),a.numThreads=s=1);let f=a.wasmPaths,d=typeof f=="string"?f:void 0,p=f?.mjs,c=p?.href??p,h=f?.wasm,g=h?.href??h,v=a.wasmBinary,[C,T]=await Bo(c,d,s>1,!!v||!!g),S=!1,U=[];if(i>0&&U.push(new Promise(D=>{setTimeout(()=>{S=!0,D()},i)})),U.push(new Promise((D,R)=>{let M={numThreads:s};if(v)M.wasmBinary=v;else if(g||d)M.locateFile=L=>g??d+L;else if(c&&c.indexOf("blob:")!==0)M.locateFile=L=>new URL(L,c).href;else if(C){let L=Io();L&&(M.locateFile=j=>L+j)}T(M).then(L=>{rr=!1,nn=!0,rn=L,D(),C&&URL.revokeObjectURL(C)},L=>{rr=!1,Mo=!0,R(L)})})),await Promise.race(U),S)throw new Error(`WebAssembly backend initializing failed due to timeout: ${i}ms`)},G=()=>{if(nn&&rn)return rn;throw new Error("WebAssembly is not initialized yet.")}});var ye,xt,$,nr=F(()=>{"use strict";Xe();ye=(a,i)=>{let s=G(),n=s.lengthBytesUTF8(a)+1,f=s._malloc(n);return s.stringToUTF8(a,f,n),i.push(f),f},xt=(a,i,s,n)=>{if(typeof a=="object"&&a!==null){if(s.has(a))throw new Error("Circular reference in options");s.add(a)}Object.entries(a).forEach(([f,d])=>{let p=i?i+f:f;if(typeof d=="object")xt(d,p+".",s,n);else if(typeof d=="string"||typeof d=="number")n(p,d.toString());else if(typeof d=="boolean")n(p,d?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof d}`)})},$=a=>{let i=G(),s=i.stackSave();try{let n=i.PTR_SIZE,f=i.stackAlloc(2*n);i._OrtGetLastError(f,f+n);let d=Number(i.getValue(f,n===4?"i32":"i64")),p=i.getValue(f+n,"*"),c=p?i.UTF8ToString(p):"";throw new Error(`${a} ERROR_CODE: ${d}, ERROR_MESSAGE: ${c}`)}finally{i.stackRestore(s)}}});var Uo,Do=F(()=>{"use strict";Xe();nr();Uo=a=>{let i=G(),s=0,n=[],f=a||{};try{if(a?.logSeverityLevel===void 0)f.logSeverityLevel=2;else if(typeof a.logSeverityLevel!="number"||!Number.isInteger(a.logSeverityLevel)||a.logSeverityLevel<0||a.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${a.logSeverityLevel}`);if(a?.logVerbosityLevel===void 0)f.logVerbosityLevel=0;else if(typeof a.logVerbosityLevel!="number"||!Number.isInteger(a.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${a.logVerbosityLevel}`);a?.terminate===void 0&&(f.terminate=!1);let d=0;return a?.tag!==void 0&&(d=ye(a.tag,n)),s=i._OrtCreateRunOptions(f.logSeverityLevel,f.logVerbosityLevel,!!f.terminate,d),s===0&&$("Can't create run options."),a?.extra!==void 0&&xt(a.extra,"",new WeakSet,(p,c)=>{let h=ye(p,n),g=ye(c,n);i._OrtAddRunConfigEntry(s,h,g)!==0&&$(`Can't set a run config entry: ${p} - ${c}.`)}),[s,n]}catch(d){throw s!==0&&i._OrtReleaseRunOptions(s),n.forEach(p=>i._free(p)),d}}});var ku,Nu,Fu,an,on,ju,Po,Ro=F(()=>{"use strict";Xe();nr();ku=a=>{switch(a){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${a}`)}},Nu=a=>{switch(a){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${a}`)}},Fu=a=>{a.extra||(a.extra={}),a.extra.session||(a.extra.session={});let i=a.extra.session;i.use_ort_model_bytes_directly||(i.use_ort_model_bytes_directly="1"),a.executionProviders&&a.executionProviders.some(s=>(typeof s=="string"?s:s.name)==="webgpu")&&(a.enableMemPattern=!1)},an=(a,i,s,n)=>{let f=ye(i,n),d=ye(s,n);G()._OrtAddSessionConfigEntry(a,f,d)!==0&&$(`Can't set a session config entry: ${i} - ${s}.`)},on=(a,i,s,n)=>{let f=ye(i,n),d=ye(s,n);a.push([f,d])},ju=async(a,i,s)=>{for(let n of i){let f=typeof n=="string"?n:n.name,d=[];switch(f){case"webnn":if(f="WEBNN",typeof n!="string"){let C=n?.deviceType;C&&an(a,"deviceType",C,s)}break;case"webgpu":{f="WebGPU";let v;if(typeof n!="string"){let T=n;if(T.device)if(typeof GPUDevice<"u"&&T.device instanceof GPUDevice)v=T.device;else throw new Error("Invalid GPU device set in WebGPU EP options.")}let C=G().webgpuRegisterDevice(v);if(C){let[T,S,U]=C;on(d,"deviceId",T.toString(),s),on(d,"webgpuInstance",S.toString(),s),on(d,"webgpuDevice",U.toString(),s)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${f}`)}let p=ye(f,s),c=d.length,h=0,g=0;if(c>0){h=G()._malloc(c*G().PTR_SIZE),s.push(h),g=G()._malloc(c*G().PTR_SIZE),s.push(g);for(let v=0;v<c;v++)G().setValue(h+v*G().PTR_SIZE,d[v][0],"*"),G().setValue(g+v*G().PTR_SIZE,d[v][1],"*")}await G()._OrtAppendExecutionProvider(a,p,h,g,c)!==0&&$(`Can't append execution provider: ${f}.`)}},Po=async a=>{let i=G(),s=0,n=[],f=a||{};Fu(f);try{let d=ku(f.graphOptimizationLevel??"all"),p=Nu(f.executionMode??"sequential"),c=typeof f.logId=="string"?ye(f.logId,n):0,h=f.logSeverityLevel??2;if(!Number.isInteger(h)||h<0||h>4)throw new Error(`log severity level is not valid: ${h}`);let g=f.logVerbosityLevel??0;if(!Number.isInteger(g)||g<0||g>4)throw new Error(`log verbosity level is not valid: ${g}`);let v=typeof f.optimizedModelFilePath=="string"?ye(f.optimizedModelFilePath,n):0;if(s=i._OrtCreateSessionOptions(d,!!f.enableCpuMemArena,!!f.enableMemPattern,p,!!f.enableProfiling,0,c,h,g,v),s===0&&$("Can't create session options."),f.executionProviders&&await ju(s,f.executionProviders,n),f.enableGraphCapture!==void 0){if(typeof f.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${f.enableGraphCapture}`);an(s,"enableGraphCapture",f.enableGraphCapture.toString(),n)}if(f.freeDimensionOverrides)for(let[C,T]of Object.entries(f.freeDimensionOverrides)){if(typeof C!="string")throw new Error(`free dimension override name must be a string: ${C}`);if(typeof T!="number"||!Number.isInteger(T)||T<0)throw new Error(`free dimension override value must be a non-negative integer: ${T}`);let S=ye(C,n);i._OrtAddFreeDimensionOverride(s,S,T)!==0&&$(`Can't set a free dimension override: ${C} - ${T}.`)}return f.extra!==void 0&&xt(f.extra,"",new WeakSet,(C,T)=>{an(s,C,T,n)}),[s,n]}catch(d){throw s!==0&&i._OrtReleaseSessionOptions(s)!==0&&$("Can't release session options."),n.forEach(p=>i._free(p)),d}}});var Ze,ir,ht,at,It,or,ar,sn,st=F(()=>{"use strict";Ze=a=>{switch(a){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${a}`)}},ir=a=>{switch(a){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${a}`)}},ht=(a,i)=>{let s=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][a],n=typeof i=="number"?i:i.reduce((f,d)=>f*d,1);return s>0?Math.ceil(n*s):void 0},at=a=>{switch(a){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${a}`)}},It=a=>{switch(a){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${a}`)}},or=a=>a==="float32"||a==="float16"||a==="int32"||a==="int64"||a==="uint32"||a==="uint8"||a==="bool"||a==="uint4"||a==="int4",ar=a=>a==="float32"||a==="float16"||a==="int32"||a==="int64"||a==="uint32"||a==="uint64"||a==="int8"||a==="uint8"||a==="bool"||a==="uint4"||a==="int4",sn=a=>{switch(a){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${a}`)}}});var Ot,un=F(()=>{"use strict";Ht();Ot=async a=>{if(typeof a=="string")if(!1)try{let{readFile:i}=Hr("node:fs/promises");return new Uint8Array(await i(a))}catch(i){if(i.code==="ERR_FS_FILE_TOO_LARGE"){let{createReadStream:s}=Hr("node:fs"),n=s(a),f=[];for await(let d of n)f.push(d);return new Uint8Array(Buffer.concat(f))}throw i}else{let i=await fetch(a);if(!i.ok)throw new Error(`failed to load external data file: ${a}`);let s=i.headers.get("Content-Length"),n=s?parseInt(s,10):0;if(n<1073741824)return new Uint8Array(await i.arrayBuffer());{if(!i.body)throw new Error(`failed to load external data file: ${a}, no response body.`);let f=i.body.getReader(),d;try{d=new ArrayBuffer(n)}catch(c){if(c instanceof RangeError){let h=Math.ceil(n/65536);d=new WebAssembly.Memory({initial:h,maximum:h}).buffer}else throw c}let p=0;for(;;){let{done:c,value:h}=await f.read();if(c)break;let g=h.byteLength;new Uint8Array(d,p,g).set(h),p+=g}return new Uint8Array(d,0,n)}}else return a instanceof Blob?new Uint8Array(await a.arrayBuffer()):a instanceof Uint8Array?a:new Uint8Array(a)}});var Wo,ko=F(()=>{"use strict";st();Wo=(a,i)=>new(at(i))(a)});var Gu,$u,No,Fo,jo,zu,ce,fn=F(()=>{"use strict";st();Gu=["V","I","W","E","F"],$u=(a,i)=>{console.log(`[${Gu[a]},${new Date().toISOString()}]${i}`)},jo=(a,i)=>{No=a,Fo=i},zu=(a,i)=>{let s=It(a),n=It(No);s>=n&&$u(s,typeof i=="function"?i():i)},ce=(...a)=>{Fo&&zu(...a)}});var $o,cn,zo,Vu,Go,Hu,Vo,sr,ur,ln,Ho,Yo=F(()=>{"use strict";st();fn();$o=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),cn=(a,i)=>{if(i==="int32")return a;let s=$o.get(i);if(!s)throw new Error(`WebNN backend does not support data type: ${i}`);let n=s/8;if(a.byteLength%n!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${n}.`);let f=a.byteLength/n,d=new(at(i))(a.buffer,a.byteOffset,f);switch(i){case"int64":case"uint64":{let p=new Int32Array(f);for(let c=0;c<f;c++){let h=d[c];if(h>2147483647n||h<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");p[c]=Number(h)}return new Uint8Array(p.buffer)}case"int8":case"uint8":case"uint32":{if(i==="uint32"&&d.some(c=>c>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let p=Int32Array.from(d,Number);return new Uint8Array(p.buffer)}default:throw new Error(`Unsupported data conversion from ${i} to 'int32'`)}},zo=(a,i)=>{if(i==="int32")return a;if(a.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let s=a.byteLength/4,n=new Int32Array(a.buffer,a.byteOffset,s);switch(i){case"int64":{let f=BigInt64Array.from(n,BigInt);return new Uint8Array(f.buffer)}case"uint64":{if(n.some(d=>d<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let f=BigUint64Array.from(n,BigInt);return new Uint8Array(f.buffer)}case"int8":{if(n.some(d=>d<-128||d>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let f=Int8Array.from(n,Number);return new Uint8Array(f.buffer)}case"uint8":{if(n.some(f=>f<0||f>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(n,Number)}case"uint32":{if(n.some(d=>d<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let f=Uint32Array.from(n,Number);return new Uint8Array(f.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${i}`)}},Vu=1,Go=()=>Vu++,Hu=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Vo=(a,i)=>{let s=$o.get(a);if(!s)throw new Error(`WebNN backend does not support data type: ${a}`);return i.length>0?Math.ceil(i.reduce((n,f)=>n*f)*s/8):0},sr=class{constructor(i){this.isDataConverted=!1;let{sessionId:s,context:n,tensor:f,dataType:d,shape:p,fallbackDataType:c}=i;this.sessionId=s,this.mlContext=n,this.mlTensor=f,this.dataType=d,this.tensorShape=p,this.fallbackDataType=c}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Vo(this.dataType,this.tensorShape)}destroy(){ce("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(i){this.mlContext.writeTensor(this.mlTensor,i)}async read(i){if(this.fallbackDataType){let s=await this.mlContext.readTensor(this.mlTensor),n=zo(new Uint8Array(s),this.dataType);if(i){(i instanceof ArrayBuffer?new Uint8Array(i):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)).set(n);return}else return n.buffer}else return i?this.mlContext.readTensor(this.mlTensor,i):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(i,s,n){return this.mlContext===i&&this.dataType===s&&this.tensorShape.length===n.length&&this.tensorShape.every((f,d)=>f===n[d])}setIsDataConverted(i){this.isDataConverted=i}},ur=class{constructor(i,s){this.tensorManager=i;this.wrapper=s}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(i,s,n,f){let d=this.tensorManager.getMLContext(i),p;if(!d.opSupportLimits().input.dataTypes.includes(s)){if(p=Hu.get(s),!p||!d.opSupportLimits().input.dataTypes.includes(p))throw new Error(`WebNN backend does not support data type: ${s}`);ce("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${s} to ${p}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(d,s,n))return this.wrapper.tensor;if(f){if(this.wrapper.byteLength!==Vo(s,n))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let c=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(i,s,n,c,!0,!0,p),f&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(i){let s=i;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")s=cn(i,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(i.byteLength===this.wrapper.byteLength){this.wrapper.write(s);return}else ce("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(s):this.activeUpload=new Uint8Array(s)}async download(i){if(this.activeUpload){let s=this.wrapper?.isDataConverted?zo(this.activeUpload,this.wrapper?.type):this.activeUpload;if(i){i instanceof ArrayBuffer?new Uint8Array(i).set(s):new Uint8Array(i.buffer,i.byteOffset,i.byteLength).set(s);return}else return s.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return i?this.wrapper.read(i):this.wrapper.read()}},ln=class{constructor(i){this.backend=i;this.tensorTrackersById=new Map;this.freeTensors=[];this.externalTensors=new Set}getMLContext(i){let s=this.backend.getMLContext(i);if(!s)throw new Error("MLContext not found for session.");return s}reserveTensorId(){let i=Go();return this.tensorTrackersById.set(i,new ur(this)),i}releaseTensorId(i){let s=this.tensorTrackersById.get(i);s&&(this.tensorTrackersById.delete(i),s.tensorWrapper&&this.releaseTensor(s.tensorWrapper))}async ensureTensor(i,s,n,f,d){ce("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${s}, dataType: ${n}, shape: ${f}, copyOld: ${d}}`);let p=this.tensorTrackersById.get(s);if(!p)throw new Error("Tensor not found.");return p.ensureTensor(i,n,f,d)}upload(i,s){let n=this.tensorTrackersById.get(i);if(!n)throw new Error("Tensor not found.");n.upload(s)}async download(i,s){ce("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${i}, dstBuffer: ${s?.byteLength}}`);let n=this.tensorTrackersById.get(i);if(!n)throw new Error("Tensor not found.");return n.download(s)}releaseTensorsForSession(i){for(let s of this.freeTensors)s.sessionId===i&&s.destroy();this.freeTensors=this.freeTensors.filter(s=>s.sessionId!==i)}registerTensor(i,s,n,f){let d=this.getMLContext(i),p=Go(),c=new sr({sessionId:i,context:d,tensor:s,dataType:n,shape:f});return this.tensorTrackersById.set(p,new ur(this,c)),this.externalTensors.add(c),p}async getCachedTensor(i,s,n,f,d,p,c){let h=this.getMLContext(i);for(let[v,C]of this.freeTensors.entries())if(C.canReuseTensor(h,s,n)){ce("verbose",()=>`[WebNN] Reusing tensor {dataType: ${s}, ${c?`fallbackDataType: ${c},`:""} shape: ${n}`);let T=this.freeTensors.splice(v,1)[0];return T.sessionId=i,T}ce("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${s}, ${c?`fallbackDataType: ${c},`:""} shape: ${n}}`);let g=await h.createTensor({dataType:c??s,shape:n,dimensions:n,usage:f,writable:d,readable:p});return new sr({sessionId:i,context:h,tensor:g,dataType:s,shape:n,fallbackDataType:c})}releaseTensor(i){this.externalTensors.has(i)&&this.externalTensors.delete(i),this.freeTensors.push(i)}},Ho=(...a)=>new ln(...a)});var qo={};_t(qo,{WebNNBackend:()=>dn});var fr,Yu,dn,Jo=F(()=>{"use strict";st();Xe();ko();Yo();fn();fr=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Yu=(a,i)=>{if(a===i)return!0;if(a===void 0||i===void 0)return!1;let s=Object.keys(a).sort(),n=Object.keys(i).sort();return s.length===n.length&&s.every((f,d)=>f===n[d]&&a[f]===i[f])},dn=class{constructor(i){this.tensorManager=Ho(this);this.mlContextBySessionId=new Map;this.sessionIdsByMLContext=new Map;this.mlContextCache=[];this.sessionGraphInputs=new Map;this.sessionGraphOutputs=new Map;this.temporaryGraphInputs=[];this.temporaryGraphOutputs=[];this.temporarySessionTensorIds=new Map;jo(i.logLevel,!!i.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(i){ce("verbose",()=>`[WebNN] onRunStart {sessionId: ${i}}`),this.activeSessionId=i}onRunEnd(i){ce("verbose",()=>`[WebNN] onRunEnd {sessionId: ${i}}`);let s=this.temporarySessionTensorIds.get(i);if(s){for(let n of s)ce("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${n}}`),this.tensorManager.releaseTensorId(n);this.temporarySessionTensorIds.delete(i),this.activeSessionId=void 0}}async createMLContext(i){if(i instanceof GPUDevice){let n=this.mlContextCache.findIndex(f=>f.gpuDevice===i);if(n!==-1)return this.mlContextCache[n].mlContext;{let f=await navigator.ml.createContext(i);return this.mlContextCache.push({gpuDevice:i,mlContext:f}),f}}else if(i===void 0){let n=this.mlContextCache.findIndex(f=>f.options===void 0&&f.gpuDevice===void 0);if(n!==-1)return this.mlContextCache[n].mlContext;{let f=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:f}),f}}let s=this.mlContextCache.findIndex(n=>Yu(n.options,i));if(s!==-1)return this.mlContextCache[s].mlContext;{let n=await navigator.ml.createContext(i);return this.mlContextCache.push({options:i,mlContext:n}),n}}registerMLContext(i,s){this.mlContextBySessionId.set(i,s);let n=this.sessionIdsByMLContext.get(s);n||(n=new Set,this.sessionIdsByMLContext.set(s,n)),n.add(i),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(i,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(i,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(i){this.sessionGraphInputs.delete(i),this.sessionGraphOutputs.delete(i);let s=this.mlContextBySessionId.get(i);if(!s)return;this.tensorManager.releaseTensorsForSession(i),this.mlContextBySessionId.delete(i);let n=this.sessionIdsByMLContext.get(s);if(n.delete(i),n.size===0){this.sessionIdsByMLContext.delete(s);let f=this.mlContextCache.findIndex(d=>d.mlContext===s);f!==-1&&this.mlContextCache.splice(f,1)}}getMLContext(i){return this.mlContextBySessionId.get(i)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(i){ce("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${i}}`),this.tensorManager.releaseTensorId(i)}async ensureTensor(i,s,n,f,d){let p=fr.get(n);if(!p)throw new Error(`Unsupported ONNX data type: ${n}`);return this.tensorManager.ensureTensor(i??this.currentSessionId,s,p,f,d)}async createTemporaryTensor(i,s,n){ce("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${s}, shape: ${n}}`);let f=fr.get(s);if(!f)throw new Error(`Unsupported ONNX data type: ${s}`);let d=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(i,d,f,n,!1);let p=this.temporarySessionTensorIds.get(i);return p?p.push(d):this.temporarySessionTensorIds.set(i,[d]),d}uploadTensor(i,s){if(!G().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");ce("verbose",()=>`[WebNN] uploadTensor {tensorId: ${i}, data: ${s.byteLength}}`),this.tensorManager.upload(i,s)}async downloadTensor(i,s){return this.tensorManager.download(i,s)}createMLTensorDownloader(i,s){return async()=>{let n=await this.tensorManager.download(i);return Wo(n,s)}}registerMLTensor(i,s,n,f){let d=fr.get(n);if(!d)throw new Error(`Unsupported ONNX data type: ${n}`);let p=this.tensorManager.registerTensor(i,s,d,f);return ce("verbose",()=>`[WebNN] registerMLTensor {tensor: ${s}, dataType: ${d}, dimensions: ${f}} -> {tensorId: ${p}}`),p}registerMLConstant(i,s,n,f,d,p,c=!1){if(!p)throw new Error("External mounted files are not available.");let h=i;i.startsWith("./")&&(h=i.substring(2));let g=p.get(h);if(!g)throw new Error(`File with name ${h} not found in preloaded files.`);if(s+n>g.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let v=g.slice(s,s+n).buffer,C;switch(d.dataType){case"float32":C=new Float32Array(v);break;case"float16":C=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(v):new Uint16Array(v);break;case"int32":C=new Int32Array(v);break;case"uint32":C=new Uint32Array(v);break;case"int64":if(c){let T=cn(new Uint8Array(v),"int64");C=new Int32Array(T.buffer),d.dataType="int32"}else C=new BigInt64Array(v);break;case"uint64":C=new BigUint64Array(v);break;case"int8":C=new Int8Array(v);break;case"int4":case"uint4":case"uint8":C=new Uint8Array(v);break;default:throw new Error(`Unsupported data type: ${d.dataType} in creating WebNN Constant from external data.`)}return ce("verbose",()=>`[WebNN] registerMLConstant {dataType: ${d.dataType}, shape: ${d.shape}}} ${c?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),f.constant(d,C)}registerGraphInput(i){this.temporaryGraphInputs.push(i)}registerGraphOutput(i){this.temporaryGraphOutputs.push(i)}isGraphInput(i,s){let n=this.sessionGraphInputs.get(i);return n?n.includes(s):!1}isGraphOutput(i,s){let n=this.sessionGraphOutputs.get(i);return n?n.includes(s):!1}isGraphInputOutputTypeSupported(i,s,n=!0){let f=this.mlContextBySessionId.get(i),d=fr.get(Ze(s));return typeof d>"u"?!1:n?!!f?.opSupportLimits().input.dataTypes.includes(d):!!f?.opSupportLimits().output.dataTypes.includes(d)}flush(){}}});var qu,Jt,Xt,ut,Ju,Xo,At,Zt,Qt,Zo,Kt,er,tr,Kr=F(()=>{"use strict";Je();Do();Ro();st();Xe();nr();un();qu=(a,i)=>{G()._OrtInit(a,i)!==0&&$("Can't initialize onnxruntime.")},Jt=async a=>{qu(a.wasm.numThreads,It(a.logLevel))},Xt=async(a,i)=>{G().asyncInit?.();let s=a.webgpu.adapter;if(i==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(s){if(typeof s.limits!="object"||typeof s.features!="object"||typeof s.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let n=a.webgpu.powerPreference;if(n!==void 0&&n!=="low-power"&&n!=="high-performance")throw new Error(`Invalid powerPreference setting: "${n}"`);let f=a.webgpu.forceFallbackAdapter;if(f!==void 0&&typeof f!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${f}"`);if(s=await navigator.gpu.requestAdapter({powerPreference:n,forceFallbackAdapter:f}),!s)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(i==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");if(i==="webgpu"&&G().webgpuInit(n=>{a.webgpu.device=n}),i==="webnn"){let n=new(Jo(),Gt(qo)).WebNNBackend(a);G().webnnInit([n,()=>n.reserveTensorId(),f=>n.releaseTensorId(f),async(f,d,p,c,h)=>n.ensureTensor(f,d,p,c,h),(f,d)=>{n.uploadTensor(f,d)},async(f,d)=>n.downloadTensor(f,d),(f,d)=>n.registerMLContext(f,d),!!a.trace])}},ut=new Map,Ju=a=>{let i=G(),s=i.stackSave();try{let n=i.PTR_SIZE,f=i.stackAlloc(2*n);i._OrtGetInputOutputCount(a,f,f+n)!==0&&$("Can't get session input/output count.");let p=n===4?"i32":"i64";return[Number(i.getValue(f,p)),Number(i.getValue(f+n,p))]}finally{i.stackRestore(s)}},Xo=(a,i)=>{let s=G(),n=s.stackSave(),f=0;try{let d=s.PTR_SIZE,p=s.stackAlloc(2*d);s._OrtGetInputOutputMetadata(a,i,p,p+d)!==0&&$("Can't get session input/output metadata.");let h=Number(s.getValue(p,"*"));f=Number(s.getValue(p+d,"*"));let g=s.HEAP32[f/4];if(g===0)return[h,0];let v=s.HEAPU32[f/4+1],C=[];for(let T=0;T<v;T++){let S=Number(s.getValue(f+8+T*d,"*"));C.push(S!==0?s.UTF8ToString(S):Number(s.getValue(f+8+(T+v)*d,"*")))}return[h,g,C]}finally{s.stackRestore(n),f!==0&&s._OrtFree(f)}},At=a=>{let i=G(),s=i._malloc(a.byteLength);if(s===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${a.byteLength}.`);return i.HEAPU8.set(a,s),[s,a.byteLength]},Zt=async(a,i)=>{let s,n,f=G();Array.isArray(a)?[s,n]=a:a.buffer===f.HEAPU8.buffer?[s,n]=[a.byteOffset,a.byteLength]:[s,n]=At(a);let d=0,p=0,c=0,h=[],g=[],v=[];try{if([p,h]=await Po(i),i?.externalData&&f.mountExternalData){let P=[];for(let z of i.externalData){let ne=typeof z=="string"?z:z.path;P.push(Ot(typeof z=="string"?z:z.data).then(fe=>{f.mountExternalData(ne,fe)}))}await Promise.all(P)}for(let P of i?.executionProviders??[])if((typeof P=="string"?P:P.name)==="webnn"){if(f.shouldTransferToMLTensor=!1,typeof P!="string"){let ne=P,fe=ne?.context,te=ne?.gpuDevice,oe=ne?.deviceType,ie=ne?.powerPreference;fe?f.currentContext=fe:te?f.currentContext=await f.webnnCreateMLContext(te):f.currentContext=await f.webnnCreateMLContext({deviceType:oe,powerPreference:ie})}else f.currentContext=await f.webnnCreateMLContext();break}d=await f._OrtCreateSession(s,n,p),f.webgpuOnCreateSession?.(d),d===0&&$("Can't create a session."),f.jsepOnCreateSession?.(),f.currentContext&&(f.webnnRegisterMLContext(d,f.currentContext),f.currentContext=void 0,f.shouldTransferToMLTensor=!0);let[C,T]=Ju(d),S=!!i?.enableGraphCapture,U=[],D=[],R=[],M=[],L=[];for(let P=0;P<C;P++){let[z,ne,fe]=Xo(d,P);z===0&&$("Can't get an input name."),g.push(z);let te=f.UTF8ToString(z);U.push(te),R.push(ne===0?{name:te,isTensor:!1}:{name:te,isTensor:!0,type:ir(ne),shape:fe})}for(let P=0;P<T;P++){let[z,ne,fe]=Xo(d,P+C);z===0&&$("Can't get an output name."),v.push(z);let te=f.UTF8ToString(z);D.push(te),M.push(ne===0?{name:te,isTensor:!1}:{name:te,isTensor:!0,type:ir(ne),shape:fe});{if(S&&i?.preferredOutputLocation===void 0){L.push("gpu-buffer");continue}let oe=typeof i?.preferredOutputLocation=="string"?i.preferredOutputLocation:i?.preferredOutputLocation?.[te]??"cpu",ie=f.webnnIsGraphOutput;if(oe==="cpu"&&ie&&ie(d,te)){L.push("ml-tensor-cpu-output");continue}if(oe!=="cpu"&&oe!=="cpu-pinned"&&oe!=="gpu-buffer"&&oe!=="ml-tensor")throw new Error(`Not supported preferred output location: ${oe}.`);if(S&&oe!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${oe}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);L.push(oe)}}let j=null;return L.some(P=>P==="gpu-buffer"||P==="ml-tensor"||P==="ml-tensor-cpu-output")&&(c=f._OrtCreateBinding(d),c===0&&$("Can't create IO binding."),j={handle:c,outputPreferredLocations:L,outputPreferredLocationsEncoded:L.map(P=>P==="ml-tensor-cpu-output"?"ml-tensor":P).map(P=>sn(P))}),ut.set(d,[d,g,v,j,S,!1]),[d,U,D,R,M]}catch(C){throw g.forEach(T=>f._OrtFree(T)),v.forEach(T=>f._OrtFree(T)),c!==0&&f._OrtReleaseBinding(c)!==0&&$("Can't release IO binding."),d!==0&&f._OrtReleaseSession(d)!==0&&$("Can't release session."),C}finally{f._free(s),p!==0&&f._OrtReleaseSessionOptions(p)!==0&&$("Can't release session options."),h.forEach(C=>f._free(C)),f.unmountExternalData?.()}},Qt=a=>{let i=G(),s=ut.get(a);if(!s)throw new Error(`cannot release session. invalid session id: ${a}`);let[n,f,d,p,c]=s;p&&(c&&i._OrtClearBoundOutputs(p.handle)!==0&&$("Can't clear bound outputs."),i._OrtReleaseBinding(p.handle)!==0&&$("Can't release IO binding.")),i.jsepOnReleaseSession?.(a),i.webnnOnReleaseSession?.(a),i.webgpuOnReleaseSession?.(a),f.forEach(h=>i._OrtFree(h)),d.forEach(h=>i._OrtFree(h)),i._OrtReleaseSession(n)!==0&&$("Can't release session."),ut.delete(a)},Zo=async(a,i,s,n,f,d,p=!1)=>{if(!a){i.push(0);return}let c=G(),h=c.PTR_SIZE,g=a[0],v=a[1],C=a[3],T=C,S,U;if(g==="string"&&(C==="gpu-buffer"||C==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(p&&C!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${d} when enableGraphCapture is true.`);if(C==="gpu-buffer"){let M=a[2].gpuBuffer;U=ht(Ze(g),v);{let L=c.webgpuRegisterBuffer;if(!L)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');S=L(M,n)}}else if(C==="ml-tensor"){let M=a[2].mlTensor;U=ht(Ze(g),v);let L=c.webnnRegisterMLTensor;if(!L)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');S=L(n,M,Ze(g),v)}else{let M=a[2];if(Array.isArray(M)){U=h*M.length,S=c._malloc(U),s.push(S);for(let L=0;L<M.length;L++){if(typeof M[L]!="string")throw new TypeError(`tensor data at index ${L} is not a string`);c.setValue(S+L*h,ye(M[L],s),"*")}}else{let L=c.webnnIsGraphInput,j=c.webnnIsGraphOutput;if(g!=="string"&&L&&j){let P=c.UTF8ToString(f);if(L(n,P)||j(n,P)){let z=Ze(g);U=ht(z,v),T="ml-tensor";let ne=c.webnnCreateTemporaryTensor,fe=c.webnnUploadTensor;if(!ne||!fe)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let te=await ne(n,z,v);fe(te,new Uint8Array(M.buffer,M.byteOffset,M.byteLength)),S=te}else U=M.byteLength,S=c._malloc(U),s.push(S),c.HEAPU8.set(new Uint8Array(M.buffer,M.byteOffset,U),S)}else U=M.byteLength,S=c._malloc(U),s.push(S),c.HEAPU8.set(new Uint8Array(M.buffer,M.byteOffset,U),S)}}let D=c.stackSave(),R=c.stackAlloc(4*v.length);try{v.forEach((L,j)=>c.setValue(R+j*h,L,h===4?"i32":"i64"));let M=c._OrtCreateTensor(Ze(g),S,U,R,v.length,sn(T));M===0&&$(`Can't create tensor for input/output. session=${n}, index=${d}.`),i.push(M)}finally{c.stackRestore(D)}},Kt=async(a,i,s,n,f,d)=>{let p=G(),c=p.PTR_SIZE,h=ut.get(a);if(!h)throw new Error(`cannot run inference. invalid session id: ${a}`);let g=h[0],v=h[1],C=h[2],T=h[3],S=h[4],U=h[5],D=i.length,R=n.length,M=0,L=[],j=[],P=[],z=[],ne=p.stackSave(),fe=p.stackAlloc(D*c),te=p.stackAlloc(D*c),oe=p.stackAlloc(R*c),ie=p.stackAlloc(R*c);try{[M,L]=Uo(d),Ye("wasm prepareInputOutputTensor");for(let W=0;W<D;W++)await Zo(s[W],j,z,a,v[i[W]],i[W],S);for(let W=0;W<R;W++)await Zo(f[W],P,z,a,C[n[W]],D+n[W],S);qe("wasm prepareInputOutputTensor");for(let W=0;W<D;W++)p.setValue(fe+W*c,j[W],"*"),p.setValue(te+W*c,v[i[W]],"*");for(let W=0;W<R;W++)p.setValue(oe+W*c,P[W],"*"),p.setValue(ie+W*c,C[n[W]],"*");if(T&&!U){let{handle:W,outputPreferredLocations:we,outputPreferredLocationsEncoded:lt}=T;if(v.length!==D)throw new Error(`input count from feeds (${D}) is expected to be always equal to model's input count (${v.length}).`);Ye("wasm bindInputsOutputs");for(let N=0;N<D;N++){let ue=i[N];await p._OrtBindInput(W,v[ue],j[N])!==0&&$(`Can't bind input[${N}] for session=${a}.`)}for(let N=0;N<R;N++){let ue=n[N];f[N]?.[3]?p._OrtBindOutput(W,C[ue],P[N],0)!==0&&$(`Can't bind pre-allocated output[${N}] for session=${a}.`):p._OrtBindOutput(W,C[ue],0,lt[ue])!==0&&$(`Can't bind output[${N}] to ${we[N]} for session=${a}.`)}qe("wasm bindInputsOutputs"),ut.set(a,[g,v,C,T,S,!0])}p.jsepOnRunStart?.(g),p.webnnOnRunStart?.(g);let Q;T?Q=await p._OrtRunWithBinding(g,T.handle,R,oe,M):Q=await p._OrtRun(g,te,fe,D,ie,R,oe,M),Q!==0&&$("failed to call OrtRun().");let ge=[],wt=[];Ye("wasm ProcessOutputTensor");for(let W=0;W<R;W++){let we=Number(p.getValue(oe+W*c,"*"));if(we===P[W]){ge.push(f[W]);continue}let lt=p.stackSave(),N=p.stackAlloc(4*c),ue=!1,Z,re=0;try{p._OrtGetTensorData(we,N,N+c,N+2*c,N+3*c)!==0&&$(`Can't access output tensor data on index ${W}.`);let Le=c===4?"i32":"i64",$e=Number(p.getValue(N,Le));re=p.getValue(N+c,"*");let I=p.getValue(N+c*2,"*"),_=Number(p.getValue(N+c*3,Le)),ve=[];for(let V=0;V<_;V++)ve.push(Number(p.getValue(I+V*c,Le)));p._OrtFree(I)!==0&&$("Can't free memory for tensor dims.");let de=ve.reduce((V,q)=>V*q,1);Z=ir($e);let De=T?.outputPreferredLocations[n[W]];if(Z==="string"){if(De==="gpu-buffer"||De==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let V=[];for(let q=0;q<de;q++){let Te=p.getValue(re+q*c,"*"),Ae=p.getValue(re+(q+1)*c,"*"),Pe=q===de-1?void 0:Ae-Te;V.push(p.UTF8ToString(Te,Pe))}ge.push([Z,ve,V,"cpu"])}else if(De==="gpu-buffer"&&de>0){let V=p.webgpuGetBuffer;if(!V)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let q=V(re),Te=ht($e,de);if(Te===void 0||!or(Z))throw new Error(`Unsupported data type: ${Z}`);ue=!0;{p.webgpuRegisterBuffer(q,a,re);let Ae=p.webgpuCreateDownloader(q,Te,a);ge.push([Z,ve,{gpuBuffer:q,download:async()=>{let Pe=await Ae();return new(at(Z))(Pe)},dispose:()=>{p._OrtReleaseTensor(we)!==0&&$("Can't release tensor.")}},"gpu-buffer"])}}else if(De==="ml-tensor"&&de>0){let V=p.webnnEnsureTensor,q=p.webnnIsGraphInputOutputTypeSupported;if(!V||!q)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(ht($e,de)===void 0||!ar(Z))throw new Error(`Unsupported data type: ${Z}`);if(!q(a,Z,!1))throw new Error(`preferredLocation "ml-tensor" for ${Z} output is not supported by current WebNN Context.`);let Ae=await V(a,re,$e,ve,!1);ue=!0,ge.push([Z,ve,{mlTensor:Ae,download:p.webnnCreateMLTensorDownloader(re,Z),dispose:()=>{p.webnnReleaseTensorId(re),p._OrtReleaseTensor(we)}},"ml-tensor"])}else if(De==="ml-tensor-cpu-output"&&de>0){let V=p.webnnCreateMLTensorDownloader(re,Z)(),q=ge.length;ue=!0,wt.push((async()=>{let Te=[q,await V];return p.webnnReleaseTensorId(re),p._OrtReleaseTensor(we),Te})()),ge.push([Z,ve,[],"cpu"])}else{let V=at(Z),q=new V(de);new Uint8Array(q.buffer,q.byteOffset,q.byteLength).set(p.HEAPU8.subarray(re,re+q.byteLength)),ge.push([Z,ve,q,"cpu"])}}finally{p.stackRestore(lt),Z==="string"&&re&&p._free(re),ue||p._OrtReleaseTensor(we)}}T&&!S&&(p._OrtClearBoundOutputs(T.handle)!==0&&$("Can't clear bound outputs."),ut.set(a,[g,v,C,T,S,!1]));for(let[W,we]of await Promise.all(wt))ge[W][2]=we;return qe("wasm ProcessOutputTensor"),ge}finally{p.webnnOnRunEnd?.(g),p.stackRestore(ne),s.forEach(Q=>{Q&&Q[3]==="gpu-buffer"&&p.webgpuUnregisterBuffer(Q[2].gpuBuffer)}),f.forEach(Q=>{Q&&Q[3]==="gpu-buffer"&&p.webgpuUnregisterBuffer(Q[2].gpuBuffer)}),j.forEach(Q=>p._OrtReleaseTensor(Q)),P.forEach(Q=>p._OrtReleaseTensor(Q)),z.forEach(Q=>p._free(Q)),M!==0&&p._OrtReleaseRunOptions(M),L.forEach(Q=>p._free(Q))}},er=a=>{let i=G(),s=ut.get(a);if(!s)throw new Error("invalid session id");let n=s[0],f=i._OrtEndProfiling(n);f===0&&$("Can't get an profile file name."),i._OrtFree(f)},tr=a=>{let i=[];for(let s of a){let n=s[2];!Array.isArray(n)&&"buffer"in n&&i.push(n.buffer)}return i}});var ft,Se,Lt,cr,dr,lr,pn,mn,bt,gt,Zu,Qo,Ko,ea,ta,ra,na,ia,yn=F(()=>{"use strict";Je();Kr();Xe();Yt();ft=()=>!!X.wasm.proxy&&typeof document<"u",Lt=!1,cr=!1,dr=!1,mn=new Map,bt=(a,i)=>{let s=mn.get(a);s?s.push(i):mn.set(a,[i])},gt=()=>{if(Lt||!cr||dr||!Se)throw new Error("worker not ready")},Zu=a=>{switch(a.data.type){case"init-wasm":Lt=!1,a.data.err?(dr=!0,pn[1](a.data.err)):(cr=!0,pn[0]()),lr&&(URL.revokeObjectURL(lr),lr=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let i=mn.get(a.data.type);a.data.err?i.shift()[1](a.data.err):i.shift()[0](a.data.out);break}default:}},Qo=async()=>{if(!cr){if(Lt)throw new Error("multiple calls to 'initWasm()' detected.");if(dr)throw new Error("previous call to 'initWasm()' failed.");if(Lt=!0,ft())return new Promise((a,i)=>{Se?.terminate(),Lo().then(([s,n])=>{try{Se=n,Se.onerror=d=>i(d),Se.onmessage=Zu,pn=[a,i];let f={type:"init-wasm",in:X};!f.in.wasm.wasmPaths&&(s||tn)&&(f.in.wasm.wasmPaths={wasm:new URL("ort-wasm-simd-threaded.asyncify.wasm",import.meta.url).href}),Se.postMessage(f),lr=s}catch(f){i(f)}},i)});try{await qt(X.wasm),await Jt(X),cr=!0}catch(a){throw dr=!0,a}finally{Lt=!1}}},Ko=async a=>{if(ft())return gt(),new Promise((i,s)=>{bt("init-ep",[i,s]);let n={type:"init-ep",in:{epName:a,env:X}};Se.postMessage(n)});await Xt(X,a)},ea=async a=>ft()?(gt(),new Promise((i,s)=>{bt("copy-from",[i,s]);let n={type:"copy-from",in:{buffer:a}};Se.postMessage(n,[a.buffer])})):At(a),ta=async(a,i)=>{if(ft()){if(i?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return gt(),new Promise((s,n)=>{bt("create",[s,n]);let f={type:"create",in:{model:a,options:{...i}}},d=[];a instanceof Uint8Array&&d.push(a.buffer),Se.postMessage(f,d)})}else return Zt(a,i)},ra=async a=>{if(ft())return gt(),new Promise((i,s)=>{bt("release",[i,s]);let n={type:"release",in:a};Se.postMessage(n)});Qt(a)},na=async(a,i,s,n,f,d)=>{if(ft()){if(s.some(p=>p[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(f.some(p=>p))throw new Error("pre-allocated output tensor is not supported for proxy.");return gt(),new Promise((p,c)=>{bt("run",[p,c]);let h=s,g={type:"run",in:{sessionId:a,inputIndices:i,inputs:h,outputIndices:n,options:d}};Se.postMessage(g,tr(h))})}else return Kt(a,i,s,n,f,d)},ia=async a=>{if(ft())return gt(),new Promise((i,s)=>{bt("end-profiling",[i,s]);let n={type:"end-profiling",in:a};Se.postMessage(n)});er(a)}});var oa,Qu,pr,aa=F(()=>{"use strict";Je();yn();st();Ht();un();oa=(a,i)=>{switch(a.location){case"cpu":return[a.type,a.dims,a.data,"cpu"];case"gpu-buffer":return[a.type,a.dims,{gpuBuffer:a.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[a.type,a.dims,{mlTensor:a.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${a.location} for ${i()}`)}},Qu=a=>{switch(a[3]){case"cpu":return new Oe(a[0],a[2],a[1]);case"gpu-buffer":{let i=a[0];if(!or(i))throw new Error(`not supported data type: ${i} for deserializing GPU tensor`);let{gpuBuffer:s,download:n,dispose:f}=a[2];return Oe.fromGpuBuffer(s,{dataType:i,dims:a[1],download:n,dispose:f})}case"ml-tensor":{let i=a[0];if(!ar(i))throw new Error(`not supported data type: ${i} for deserializing MLTensor tensor`);let{mlTensor:s,download:n,dispose:f}=a[2];return Oe.fromMLTensor(s,{dataType:i,dims:a[1],download:n,dispose:f})}default:throw new Error(`invalid data location: ${a[3]}`)}},pr=class{async fetchModelAndCopyToWasmMemory(i){return ea(await Ot(i))}async loadModel(i,s){nt();let n;typeof i=="string"?n=await this.fetchModelAndCopyToWasmMemory(i):n=i,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await ta(n,s),it()}async dispose(){return ra(this.sessionId)}async run(i,s,n){nt();let f=[],d=[];Object.entries(i).forEach(T=>{let S=T[0],U=T[1],D=this.inputNames.indexOf(S);if(D===-1)throw new Error(`invalid input '${S}'`);f.push(U),d.push(D)});let p=[],c=[];Object.entries(s).forEach(T=>{let S=T[0],U=T[1],D=this.outputNames.indexOf(S);if(D===-1)throw new Error(`invalid output '${S}'`);p.push(U),c.push(D)});let h=f.map((T,S)=>oa(T,()=>`input "${this.inputNames[d[S]]}"`)),g=p.map((T,S)=>T?oa(T,()=>`output "${this.outputNames[c[S]]}"`):null),v=await na(this.sessionId,d,h,c,g,n),C={};for(let T=0;T<v.length;T++)C[this.outputNames[c[T]]]=p[T]??Qu(v[T]);return it(),C}startProfiling(){}endProfiling(){ia(this.sessionId)}}});var ua={};_t(ua,{OnnxruntimeWebAssemblyBackend:()=>mr,initializeFlags:()=>sa,wasmBackend:()=>Ku});var sa,mr,Ku,fa=F(()=>{"use strict";Je();yn();aa();sa=()=>{(typeof X.wasm.initTimeout!="number"||X.wasm.initTimeout<0)&&(X.wasm.initTimeout=0);let a=X.wasm.simd;if(typeof a!="boolean"&&a!==void 0&&a!=="fixed"&&a!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${a}". Reset it to \`false\` and ignore SIMD feature checking.`),X.wasm.simd=!1),typeof X.wasm.proxy!="boolean"&&(X.wasm.proxy=!1),typeof X.wasm.trace!="boolean"&&(X.wasm.trace=!1),typeof X.wasm.numThreads!="number"||!Number.isInteger(X.wasm.numThreads)||X.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)X.wasm.numThreads=1;else{let i=typeof navigator>"u"?Hr("node:os").cpus().length:navigator.hardwareConcurrency;X.wasm.numThreads=Math.min(4,Math.ceil((i||1)/2))}},mr=class{async init(i){sa(),await Qo(),await Ko(i)}async createInferenceSessionHandler(i,s){let n=new pr;return await n.loadModel(i,s),n}},Ku=new mr});Je();Je();Je();var bo="1.23.0";var Kl=Qr;{let a=(fa(),Gt(ua)).wasmBackend;tt("webgpu",a,5),tt("webnn",a,5),tt("cpu",a,10),tt("wasm",a,10)}Object.defineProperty(X.versions,"web",{value:bo,enumerable:!0});export{xu as InferenceSession,uo as TRACE,Ye as TRACE_EVENT_BEGIN,qe as TRACE_EVENT_END,nt as TRACE_FUNC_BEGIN,it as TRACE_FUNC_END,Oe as Tensor,Kl as default,X as env,tt as registerBackend};
//# sourceMappingURL=ort.webgpu.bundle.min.mjs.map
